var M=Object.create;var a=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var P=(e,o)=>{for(var t in o)a(e,t,{get:o[t],enumerable:!0})},x=(e,o,t,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of F(o))!h.call(e,n)&&n!==t&&a(e,n,{get:()=>o[n],enumerable:!(r=A(o,n))||r.enumerable});return e};var v=(e,o,t)=>(t=e!=null?M(T(e)):{},x(o||!e||!e.__esModule?a(t,"default",{value:e,enumerable:!0}):t,e)),W=e=>x(a({},"__esModule",{value:!0}),e);var $={};P($,{default:()=>V});module.exports=W($);var S=require("@parcel/plugin"),L=v(require("@parcel/source-map")),N=require("@swc/core"),w=v(require("nullthrows"));var l=globalThis.process?.argv||[];var y=()=>globalThis.process?.env||{};var z=new Set(l),E=e=>z.has(e),D=l.filter(e=>e.startsWith("--")&&e.includes("=")).map(e=>e.split("=")).reduce((e,[o,t])=>(e[o]=t,e),{});var G=E("--dry-run"),g=()=>E("--verbose")||y().VERBOSE==="true",q=g();var B=(e="",...o)=>console.log(e.padEnd(9),"|",...o);var I=0,p=(...e)=>g()&&B(`\u{1F7E1} ${I++}`,...e);var c=require("buffer"),_=require("stream");function j(e){return new Promise((o,t)=>{let r=c.Buffer.from([]);e.on("data",n=>{r=c.Buffer.concat([r,n])}),e.on("end",()=>{o(r)}),e.on("error",t)})}async function O(e){return typeof e=="string"?e:e instanceof _.Readable?(await j(e)).toString():e instanceof c.Buffer?e.toString():e}var V=new S.Optimizer({async optimize({contents:e,map:o,bundle:t,options:r,getSourceMapReference:n}){p("@plasmohq/optimizer-es: ",t.name,t.displayName,r.projectRoot);let u=await O(e);if(!t.env.shouldOptimize)return p("optimizer-es: skipped"),{contents:u,map:o};let m=process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS,i=process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_MINIFY==="false";p(`optimizer-es: use SWC for ${t.displayName}`);let f=await(0,N.transform)(u,{jsc:{target:process.env.__PLASMO_FRAMEWORK_INTERNAL_ES_TARGET,minify:{format:{comments:i?"some":"all"},mangle:i,compress:i,sourceMap:m!=="none",toplevel:t.env.outputFormat==="esmodule"||t.env.outputFormat==="commonjs",module:t.env.outputFormat==="esmodule"}},minify:i,sourceMaps:m==="inline"?"inline":m==="external",configFile:!1,swcrc:!1}),s=null,R=(0,w.default)(f.code);if(f.map){s=new L.default(r.projectRoot),s.addVLQMap(JSON.parse(f.map)),o&&s.extends(o);let d=await n(s);d&&(R+=`
//# sourceMappingURL=${d}
`)}return{contents:R,map:s}}});
