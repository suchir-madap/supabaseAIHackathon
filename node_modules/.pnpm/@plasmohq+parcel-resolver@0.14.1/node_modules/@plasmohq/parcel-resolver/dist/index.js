var H=Object.create;var h=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var Q=(t,e)=>{for(var o in e)h(t,o,{get:e[o],enumerable:!0})},S=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of U(e))!q.call(t,s)&&s!==o&&h(t,s,{get:()=>e[s],enumerable:!(n=K(e,s))||n.enumerable});return t};var E=(t,e,o)=>(o=t!=null?H(X(t)):{},S(e||!t||!t.__esModule?h(o,"default",{value:t,enumerable:!0}):o,t)),Y=t=>S(h({},"__esModule",{value:!0}),t);var at={};Q(at,{default:()=>it});module.exports=Y(at);var G=require("@parcel/plugin");var c=require("path"),P=require("fs-extra");var L=require("fs"),a=require("path"),M=E(require("fast-glob")),C=require("fs-extra");var x=globalThis.process?.argv||[];var R=()=>globalThis.process?.env||{},Z=/\$([\w+]+)/gm,b=(t,e=R(),o=Z)=>t.replace(o,(n,s)=>e[s]||n);var tt=new Set(x),D=t=>tt.has(t),ft=x.filter(t=>t.startsWith("--")&&t.includes("=")).map(t=>t.split("=")).reduce((t,[e,o])=>(t[e]=o,t),{});var gt=D("--dry-run"),d=()=>D("--verbose")||R().VERBOSE==="true",yt=d();var et=(t="",...e)=>console.log(t.padEnd(9),"|",...e);var ot=0,g=(...t)=>d()&&et(`\u{1F7E1} ${ot++}`,...t);var m=require("path"),F=t=>t.replaceAll(m.win32.sep,m.posix.sep);var l=[".ts",".tsx",".svelte",".vue",".json"],A=new Set(["data-text","data-base64","data-env","data-text-env","raw","raw-env"]),O=new Set(l),r={got:null,dotPlasmoDirectory:null,remoteCacheDirectory:null,polyfillMap:null,aliasMap:null},_=async t=>{if(r.got===null&&(r.got=(await import("got")).default),r.dotPlasmoDirectory||(r.dotPlasmoDirectory=(0,a.resolve)(process.env.PLASMO_PROJECT_DIR,".plasmo")),r.remoteCacheDirectory||(r.remoteCacheDirectory=(0,a.resolve)(r.dotPlasmoDirectory,"cache","remote-code"),await t.options.inputFS.exists(r.remoteCacheDirectory)||(g("Reinitializing remote cache directory"),await t.options.inputFS.mkdirp(r.remoteCacheDirectory))),!r.polyfillMap){let e=(0,a.join)(__dirname,"polyfills"),o=await(0,M.default)("**/*.js",{cwd:e,onlyFiles:!0});r.polyfillMap=new Map(o.map(n=>[F(n.slice(0,-3)),(0,a.join)(e,n)]))}if(!r.aliasMap){let e=await(0,C.readJson)((0,a.resolve)(process.env.PLASMO_PROJECT_DIR,"package.json"));r.aliasMap=new Map(Object.entries(e.alias||{}))}},u=async(t,e=l,o={})=>{let n=e.flatMap(s=>[`${t}${s}`,(0,a.resolve)(t,`index${s}`)]);for(let s of n)try{if((0,L.statSync)(s).isFile())return{filePath:s,...o}}catch{}return null};async function $({specifier:t,dependency:e}){if(t[0]!=="/")return null;if((0,P.pathExistsSync)(t))return{filePath:t};let o=(0,c.resolve)((0,c.join)(process.env.PLASMO_PROJECT_DIR,t.slice(1)));if((0,c.extname)(o).length>0&&(0,P.pathExistsSync)(o))return{filePath:o};let s=(0,c.extname)(e.resolveFrom),i=[s,...l.filter(f=>f!==s)];return u(o,i)}var I=require("path");var T=require("fs"),y=require("fs/promises");async function rt(t,e){try{return await(0,y.access)(t,e),!0}catch{return!1}}async function k(t){return rt(t,T.constants.R_OK)}async function j({specifier:t}){if(!r.aliasMap.has(t))return null;let e=(0,I.resolve)(r.aliasMap.get(t));return await k(e)?{filePath:e,priority:"sync"}:null}var w=require("path");var st=(t="",e="",o="")=>{if(!t.startsWith(e))return null;let[n,s]=t.split(e);return u((0,w.resolve)(o,s))};async function W({specifier:t}){return st(t,"@plasmo-static-common/",(0,w.resolve)(r.dotPlasmoDirectory,"static","common"))}async function N({specifier:t}){return r.polyfillMap.has(t)?{filePath:r.polyfillMap.get(t),priority:"sync"}:null}var J=require("path"),z=require("@parcel/hash");var nt=async(t,e)=>t.origin==="https://www.googletagmanager.com"?e.replace(/http:/g,"chrome-extension:"):e;async function V({specifier:t,dependency:e,options:o}){if(!t.startsWith("https://")||!l.some(i=>e.sourcePath.endsWith(i)))return null;let n=new URL(b(t)),s=n.searchParams.get("plasmo-ext")||"js";try{let i=(0,J.resolve)(r.remoteCacheDirectory,`${(0,z.hashString)(t)}.${s}`),f=await r.got(n.toString()).text(),v=await nt(n,f);return await o.inputFS.rimraf(i),await o.inputFS.writeFile(i,v,{mode:436}),g(`Caching HTTPS dependency: ${t}`),{priority:"lazy",sideEffects:!0,filePath:i}}catch(i){return{diagnostics:[{message:`Cannot download the resource from ${t}`,hints:[i.message]}]}}}var p=require("path");async function B({pipeline:t,specifier:e,dependency:o}){if(e[0]!=="~")return null;let n=(0,p.resolve)((0,p.join)(process.env.PLASMO_SRC_DIR,e.slice(1)));if(A.has(t))return{filePath:n};let s=(0,p.extname)(n);if(s.length>0&&O.has(s))return{filePath:n};let i=(0,p.extname)(o.resolveFrom),f=[i,...l.filter(v=>v!==i)];return u(n,f)}var it=new G.Resolver({async resolve(t){return await _(t),await j(t)||await W(t)||await N(t)||await V(t)||await B(t)||await $(t)||null}});
