#!/usr/bin/env node
import { createRequire } from 'module';const require = createRequire(import.meta.url);
var jl=Object.create;var ln=Object.defineProperty;var Ul=Object.getOwnPropertyDescriptor;var ql=Object.getOwnPropertyNames;var Wl=Object.getPrototypeOf,Vl=Object.prototype.hasOwnProperty;var v=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var y=(t,e)=>()=>(t&&(e=t(t=0)),e);var x=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ke=(t,e)=>{for(var r in e)ln(t,r,{get:e[r],enumerable:!0})},Hl=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ql(e))!Vl.call(t,i)&&i!==r&&ln(t,i,{get:()=>e[i],enumerable:!(n=Ul(e,i))||n.enumerable});return t};var A=(t,e,r)=>(r=t!=null?jl(Wl(t)):{},Hl(e||!t||!t.__esModule?ln(r,"default",{value:t,enumerable:!0}):r,t));var ot,tr,rr=y(()=>{ot=globalThis.process?.argv||[],tr=(t=ot[2])=>ot.filter(e=>!e.startsWith("--")).slice(ot.indexOf(t)+1)});var un,Gl,$i,fn=y(()=>{un=()=>globalThis.process?.env||{},Gl=/\$([\w+]+)/gm,$i=(t,e=un(),r=Gl)=>t.replace(r,(n,i)=>e[i]||n)});var Jl,$,zl,V,hg,Ct,Ri,de=y(()=>{rr();fn();Jl=new Set(ot),$=t=>Jl.has(t),zl=ot.filter(t=>t.startsWith("--")&&t.includes("=")).map(t=>t.split("=")).reduce((t,[e,r])=>(t[e]=r,t),{}),V=t=>zl[t],hg=$("--dry-run"),Ct=()=>$("--verbose")||un().VERBOSE==="true",Ri=Ct()});var De,Bi,Fe,le,N,j,Yl,d,k=y(()=>{de();De=(t="",...e)=>console.log(t.padEnd(9),"|",...e),Bi=(...t)=>De("",...t),Fe=(...t)=>De("\u{1F7E2} DONE",...t),le=(...t)=>console.error("\u{1F534} ERROR".padEnd(9),"|",...t),N=(...t)=>De("\u{1F535} INFO",...t),j=(...t)=>De("\u{1F7E0} WARN",...t),Yl=0,d=(...t)=>Ct()&&De(`\u{1F7E1} ${Yl++}`,...t)});import{kebabCase as Kl}from"change-case";var Ae,ji,Ui,st=y(()=>{de();Ae=()=>{let t=V("--src-path")||process.env.PLASMO_SRC_PATH||"src",e=V("--build-path")||process.env.PLASMO_BUILD_PATH||"build",r=V("--tag")||process.env.PLASMO_TAG||(process.env.NODE_ENV==="production"?"prod":"dev"),n=Kl(V("--target")||process.env.PLASMO_TARGET||"chrome-mv3"),[i,o]=n.split("-"),s=V("--entry")||"popup",a=V("--env");return{browser:i,manifestVersion:o,tag:r,srcPath:t,buildPath:e,target:n,entry:s,envPath:a}},ji=`      --target=[string]           set the target (default: chrome-mv3)
      --tag=[string]              set the build tag (default: dev or prod depending on NODE_ENV)
      --src-path=[path]           set the source path relative to project root (default: src)
      --build-path=[path]         set the build path relative to project root (default: build)
      --entry=[name]                     entry point name (default: popup)
      --env=[path]                       relative path to top-level env file`,Ui=`
    
    init

      --entry=[name]              entry files (default: popup)
      --with-<name>               use an example template

    dev     

${ji}

    build

${ji}
      --zip                       zip the build output
`});var ue,nr,Xe=y(()=>{k();mn();st();ue=()=>{console.log("\u{1F7E3} Plasmo v0.89.4"),console.log("\u{1F534} The Browser Extension Framework")},nr=()=>{De("\u{1F7E0} CMDS",pn.join(" | ")),De("\u{1F7E1} OPTS",Ui)}});var qi={};Ke(qi,{default:()=>Zl});async function Xl(){ue(),nr()}var Zl,Wi=y(()=>{Xe();Zl=Xl});var Vi={};Ke(Vi,{default:()=>eu});async function Ql(){N("Start the extension development...")}var eu,Hi=y(()=>{k();eu=Ql});import{constants as dn}from"fs";import{access as tu,mkdir as ru,readdir as nu,stat as Gi}from"fs/promises";async function hn(t,e){try{return await tu(t,e),!0}catch{return!1}}async function ir(t){return hn(t,dn.W_OK)}async function or(t){return hn(t,dn.R_OK)}async function F(t){return hn(t,dn.F_OK)}async function Ji(t){try{return(await Gi(t)).isDirectory()}catch{return!1}}async function sr(t){try{return(await Gi(t)).isFile()}catch{return!1}}async function ou(t){let e=(await nu(t,{withFileTypes:!0})).filter(r=>!iu.has(r.name)).filter(r=>!/\.iml$/.test(r.name));if(e.length>0){d(`Found conflicting contents in ${t}`);let r=e.reduce((n,i)=>`${n}
	${i.name}${i.isDirectory()?"/":""}`,"");return d(r),!1}return!0}async function zi(t){if(!await ir(t))d("Directory does not exist, creating..."),await ru(t);else{if(d("Directory exists, checking if it is empty..."),!await ou(t))throw new Error(`Directory ${t} is not empty.`);if(d("Checking if directory is writable..."),!await ir(t))throw new Error(`Directory ${t} is not accesible.`)}}var iu,Y=y(()=>{k();iu=new Set([".DS_Store",".git",".gitattributes",".gitignore",".gitlab-ci.yml",".hg",".hgcheck",".hgignore",".idea",".npmignore",".travis.yml","LICENSE","Thumbs.db","docs","mkdocs.yml","npm-debug.log","yarn-debug.log","yarn-error.log",".pnpm-debug.log"])});import{existsSync as su}from"fs";import{basename as au,resolve as oe}from"path";import{cwd as cu}from"process";var at,ar=y(()=>{st();at=(t=cu())=>{let e=Ae();process.env.PLASMO_PROJECT_DIR=t;let r=au(t);process.env.PLASMO_SRC_PATH=e.srcPath;let n=oe(t,e.srcPath);process.env.PLASMO_SRC_DIR=su(n)?n:t,process.env.PLASMO_BUILD_PATH=e.buildPath;let i=oe(t,e.buildPath);process.env.PLASMO_BUILD_DIR=i;let o=`${e.target}-${e.tag}`,s=oe(i,o),a=oe(t,".plasmo"),c=oe(a,"cache");return{packageName:r,projectDirectory:t,buildDirectory:i,distDirectory:s,distDirectoryName:o,sourceDirectory:process.env.PLASMO_SRC_DIR,packageFilePath:oe(t,"package.json"),gitIgnorePath:oe(t,".gitignore"),assetsDirectory:oe(t,"assets"),parcelConfig:oe(t,".parcelrc"),dotPlasmoDirectory:a,cacheDirectory:c,plasmoVersionFilePath:oe(c,"plasmo.version.json"),staticDirectory:oe(a,"static"),genAssetsDirectory:oe(a,"gen-assets"),entryManifestPath:oe(a,`${e.target}.plasmo.manifest.json`)}}});import lu from"@expo/spawn-async";import uu from"semver";async function gn(t){let e=await lu(t,["--version"]),r=uu.valid(e.stdout.trim())||void 0;return{name:t,version:r}}async function ct(){try{let t=process.env.npm_config_user_agent;if(t){if(t.startsWith("yarn"))return{name:"yarn"};if(t.startsWith("pnpm"))return{name:"pnpm"}}try{return await gn("pnpm")}catch{return await gn("yarn")}}catch{return await gn("npm")}}var cr=y(()=>{});var Q=x(yn=>{"use strict";yn.fromCallback=function(t){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")t.apply(this,e);else return new Promise((r,n)=>{t.call(this,...e,(i,o)=>i!=null?n(i):r(o))})},"name",{value:t.name})};yn.fromPromise=function(t){return Object.defineProperty(function(...e){let r=e[e.length-1];if(typeof r!="function")return t.apply(this,e);t.apply(this,e.slice(0,-1)).then(n=>r(null,n),r)},"name",{value:t.name})}});var Ki=x((Ug,Yi)=>{var $e=v("constants"),fu=process.cwd,lr=null,pu=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return lr||(lr=fu.call(process)),lr};try{process.cwd()}catch{}typeof process.chdir=="function"&&(_n=process.chdir,process.chdir=function(t){lr=null,_n.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,_n));var _n;Yi.exports=mu;function mu(t){$e.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(t),t.lutimes||r(t),t.chown=o(t.chown),t.fchown=o(t.fchown),t.lchown=o(t.lchown),t.chmod=n(t.chmod),t.fchmod=n(t.fchmod),t.lchmod=n(t.lchmod),t.chownSync=s(t.chownSync),t.fchownSync=s(t.fchownSync),t.lchownSync=s(t.lchownSync),t.chmodSync=i(t.chmodSync),t.fchmodSync=i(t.fchmodSync),t.lchmodSync=i(t.lchmodSync),t.stat=a(t.stat),t.fstat=a(t.fstat),t.lstat=a(t.lstat),t.statSync=c(t.statSync),t.fstatSync=c(t.fstatSync),t.lstatSync=c(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(l,f,p){p&&process.nextTick(p)},t.lchmodSync=function(){}),t.chown&&!t.lchown&&(t.lchown=function(l,f,p,m){m&&process.nextTick(m)},t.lchownSync=function(){}),pu==="win32"&&(t.rename=typeof t.rename!="function"?t.rename:function(l){function f(p,m,h){var g=Date.now(),_=0;l(p,m,function S(C){if(C&&(C.code==="EACCES"||C.code==="EPERM"||C.code==="EBUSY")&&Date.now()-g<6e4){setTimeout(function(){t.stat(m,function(I,J){I&&I.code==="ENOENT"?l(p,m,S):h(C)})},_),_<100&&(_+=10);return}h&&h(C)})}return Object.setPrototypeOf&&Object.setPrototypeOf(f,l),f}(t.rename)),t.read=typeof t.read!="function"?t.read:function(l){function f(p,m,h,g,_,S){var C;if(S&&typeof S=="function"){var I=0;C=function(J,me,Te){if(J&&J.code==="EAGAIN"&&I<10)return I++,l.call(t,p,m,h,g,_,C);S.apply(this,arguments)}}return l.call(t,p,m,h,g,_,C)}return Object.setPrototypeOf&&Object.setPrototypeOf(f,l),f}(t.read),t.readSync=typeof t.readSync!="function"?t.readSync:function(l){return function(f,p,m,h,g){for(var _=0;;)try{return l.call(t,f,p,m,h,g)}catch(S){if(S.code==="EAGAIN"&&_<10){_++;continue}throw S}}}(t.readSync);function e(l){l.lchmod=function(f,p,m){l.open(f,$e.O_WRONLY|$e.O_SYMLINK,p,function(h,g){if(h){m&&m(h);return}l.fchmod(g,p,function(_){l.close(g,function(S){m&&m(_||S)})})})},l.lchmodSync=function(f,p){var m=l.openSync(f,$e.O_WRONLY|$e.O_SYMLINK,p),h=!0,g;try{g=l.fchmodSync(m,p),h=!1}finally{if(h)try{l.closeSync(m)}catch{}else l.closeSync(m)}return g}}function r(l){$e.hasOwnProperty("O_SYMLINK")&&l.futimes?(l.lutimes=function(f,p,m,h){l.open(f,$e.O_SYMLINK,function(g,_){if(g){h&&h(g);return}l.futimes(_,p,m,function(S){l.close(_,function(C){h&&h(S||C)})})})},l.lutimesSync=function(f,p,m){var h=l.openSync(f,$e.O_SYMLINK),g,_=!0;try{g=l.futimesSync(h,p,m),_=!1}finally{if(_)try{l.closeSync(h)}catch{}else l.closeSync(h)}return g}):l.futimes&&(l.lutimes=function(f,p,m,h){h&&process.nextTick(h)},l.lutimesSync=function(){})}function n(l){return l&&function(f,p,m){return l.call(t,f,p,function(h){u(h)&&(h=null),m&&m.apply(this,arguments)})}}function i(l){return l&&function(f,p){try{return l.call(t,f,p)}catch(m){if(!u(m))throw m}}}function o(l){return l&&function(f,p,m,h){return l.call(t,f,p,m,function(g){u(g)&&(g=null),h&&h.apply(this,arguments)})}}function s(l){return l&&function(f,p,m){try{return l.call(t,f,p,m)}catch(h){if(!u(h))throw h}}}function a(l){return l&&function(f,p,m){typeof p=="function"&&(m=p,p=null);function h(g,_){_&&(_.uid<0&&(_.uid+=4294967296),_.gid<0&&(_.gid+=4294967296)),m&&m.apply(this,arguments)}return p?l.call(t,f,p,h):l.call(t,f,h)}}function c(l){return l&&function(f,p){var m=p?l.call(t,f,p):l.call(t,f);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}function u(l){if(!l||l.code==="ENOSYS")return!0;var f=!process.getuid||process.getuid()!==0;return!!(f&&(l.code==="EINVAL"||l.code==="EPERM"))}}});var Qi=x((qg,Zi)=>{var Xi=v("stream").Stream;Zi.exports=du;function du(t){return{ReadStream:e,WriteStream:r};function e(n,i){if(!(this instanceof e))return new e(n,i);Xi.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,c=s.length;a<c;a++){var u=s[a];this[u]=i[u]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}t.open(this.path,this.flags,this.mode,function(l,f){if(l){o.emit("error",l),o.readable=!1;return}o.fd=f,o.emit("open",f),o._read()})}function r(n,i){if(!(this instanceof r))return new r(n,i);Xi.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var c=o[s];this[c]=i[c]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var to=x((Wg,eo)=>{"use strict";eo.exports=gu;var hu=Object.getPrototypeOf||function(t){return t.__proto__};function gu(t){if(t===null||typeof t!="object")return t;if(t instanceof Object)var e={__proto__:hu(t)};else var e=Object.create(null);return Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}});var ee=x((Vg,vn)=>{var D=v("fs"),yu=Ki(),_u=Qi(),wu=to(),ur=v("util"),H,pr;typeof Symbol=="function"&&typeof Symbol.for=="function"?(H=Symbol.for("graceful-fs.queue"),pr=Symbol.for("graceful-fs.previous")):(H="___graceful-fs.queue",pr="___graceful-fs.previous");function xu(){}function io(t,e){Object.defineProperty(t,H,{get:function(){return e}})}var Ze=xu;ur.debuglog?Ze=ur.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Ze=function(){var t=ur.format.apply(ur,arguments);t="GFS4: "+t.split(/\n/).join(`
GFS4: `),console.error(t)});D[H]||(ro=global[H]||[],io(D,ro),D.close=function(t){function e(r,n){return t.call(D,r,function(i){i||no(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,pr,{value:t}),e}(D.close),D.closeSync=function(t){function e(r){t.apply(D,arguments),no()}return Object.defineProperty(e,pr,{value:t}),e}(D.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Ze(D[H]),v("assert").equal(D[H].length,0)}));var ro;global[H]||io(global,D[H]);vn.exports=wn(wu(D));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!D.__patched&&(vn.exports=wn(D),D.__patched=!0);function wn(t){yu(t),t.gracefulify=wn,t.createReadStream=me,t.createWriteStream=Te;var e=t.readFile;t.readFile=r;function r(w,E,P){return typeof E=="function"&&(P=E,E=null),B(w,E,P);function B(U,b,L,O){return e(U,b,function(T){T&&(T.code==="EMFILE"||T.code==="ENFILE")?lt([B,[U,b,L],T,O||Date.now(),Date.now()]):typeof L=="function"&&L.apply(this,arguments)})}}var n=t.writeFile;t.writeFile=i;function i(w,E,P,B){return typeof P=="function"&&(B=P,P=null),U(w,E,P,B);function U(b,L,O,T,W){return n(b,L,O,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?lt([U,[b,L,O,T],M,W||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}var o=t.appendFile;o&&(t.appendFile=s);function s(w,E,P,B){return typeof P=="function"&&(B=P,P=null),U(w,E,P,B);function U(b,L,O,T,W){return o(b,L,O,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?lt([U,[b,L,O,T],M,W||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}var a=t.copyFile;a&&(t.copyFile=c);function c(w,E,P,B){return typeof P=="function"&&(B=P,P=0),U(w,E,P,B);function U(b,L,O,T,W){return a(b,L,O,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?lt([U,[b,L,O,T],M,W||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}var u=t.readdir;t.readdir=f;var l=/^v[0-5]\./;function f(w,E,P){typeof E=="function"&&(P=E,E=null);var B=l.test(process.version)?function(L,O,T,W){return u(L,U(L,O,T,W))}:function(L,O,T,W){return u(L,O,U(L,O,T,W))};return B(w,E,P);function U(b,L,O,T){return function(W,M){W&&(W.code==="EMFILE"||W.code==="ENFILE")?lt([B,[b,L,O],W,T||Date.now(),Date.now()]):(M&&M.sort&&M.sort(),typeof O=="function"&&O.call(this,W,M))}}}if(process.version.substr(0,4)==="v0.8"){var p=_u(t);S=p.ReadStream,I=p.WriteStream}var m=t.ReadStream;m&&(S.prototype=Object.create(m.prototype),S.prototype.open=C);var h=t.WriteStream;h&&(I.prototype=Object.create(h.prototype),I.prototype.open=J),Object.defineProperty(t,"ReadStream",{get:function(){return S},set:function(w){S=w},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WriteStream",{get:function(){return I},set:function(w){I=w},enumerable:!0,configurable:!0});var g=S;Object.defineProperty(t,"FileReadStream",{get:function(){return g},set:function(w){g=w},enumerable:!0,configurable:!0});var _=I;Object.defineProperty(t,"FileWriteStream",{get:function(){return _},set:function(w){_=w},enumerable:!0,configurable:!0});function S(w,E){return this instanceof S?(m.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}function C(){var w=this;be(w.path,w.flags,w.mode,function(E,P){E?(w.autoClose&&w.destroy(),w.emit("error",E)):(w.fd=P,w.emit("open",P),w.read())})}function I(w,E){return this instanceof I?(h.apply(this,arguments),this):I.apply(Object.create(I.prototype),arguments)}function J(){var w=this;be(w.path,w.flags,w.mode,function(E,P){E?(w.destroy(),w.emit("error",E)):(w.fd=P,w.emit("open",P))})}function me(w,E){return new t.ReadStream(w,E)}function Te(w,E){return new t.WriteStream(w,E)}var Me=t.open;t.open=be;function be(w,E,P,B){return typeof P=="function"&&(B=P,P=null),U(w,E,P,B);function U(b,L,O,T,W){return Me(b,L,O,function(M,cg){M&&(M.code==="EMFILE"||M.code==="ENFILE")?lt([U,[b,L,O,T],M,W||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}return t}function lt(t){Ze("ENQUEUE",t[0].name,t[1]),D[H].push(t),xn()}var fr;function no(){for(var t=Date.now(),e=0;e<D[H].length;++e)D[H][e].length>2&&(D[H][e][3]=t,D[H][e][4]=t);xn()}function xn(){if(clearTimeout(fr),fr=void 0,D[H].length!==0){var t=D[H].shift(),e=t[0],r=t[1],n=t[2],i=t[3],o=t[4];if(i===void 0)Ze("RETRY",e.name,r),e.apply(null,r);else if(Date.now()-i>=6e4){Ze("TIMEOUT",e.name,r);var s=r.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,c=Math.max(o-i,1),u=Math.min(c*1.2,100);a>=u?(Ze("RETRY",e.name,r),e.apply(null,r.concat([i]))):D[H].push(t)}fr===void 0&&(fr=setTimeout(xn,0))}}});var Qe=x(ke=>{"use strict";var oo=Q().fromCallback,K=ee(),vu=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(t=>typeof K[t]=="function");Object.assign(ke,K);vu.forEach(t=>{ke[t]=oo(K[t])});ke.exists=function(t,e){return typeof e=="function"?K.exists(t,e):new Promise(r=>K.exists(t,r))};ke.read=function(t,e,r,n,i,o){return typeof o=="function"?K.read(t,e,r,n,i,o):new Promise((s,a)=>{K.read(t,e,r,n,i,(c,u,l)=>{if(c)return a(c);s({bytesRead:u,buffer:l})})})};ke.write=function(t,e,...r){return typeof r[r.length-1]=="function"?K.write(t,e,...r):new Promise((n,i)=>{K.write(t,e,...r,(o,s,a)=>{if(o)return i(o);n({bytesWritten:s,buffer:a})})})};ke.readv=function(t,e,...r){return typeof r[r.length-1]=="function"?K.readv(t,e,...r):new Promise((n,i)=>{K.readv(t,e,...r,(o,s,a)=>{if(o)return i(o);n({bytesRead:s,buffers:a})})})};ke.writev=function(t,e,...r){return typeof r[r.length-1]=="function"?K.writev(t,e,...r):new Promise((n,i)=>{K.writev(t,e,...r,(o,s,a)=>{if(o)return i(o);n({bytesWritten:s,buffers:a})})})};typeof K.realpath.native=="function"?ke.realpath.native=oo(K.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var ao=x((Gg,so)=>{"use strict";var Su=v("path");so.exports.checkPath=function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(Su.parse(e).root,""))){let n=new Error(`Path contains invalid characters: ${e}`);throw n.code="EINVAL",n}}});var fo=x((Jg,Sn)=>{"use strict";var co=Qe(),{checkPath:lo}=ao(),uo=t=>{let e={mode:511};return typeof t=="number"?t:{...e,...t}.mode};Sn.exports.makeDir=async(t,e)=>(lo(t),co.mkdir(t,{mode:uo(e),recursive:!0}));Sn.exports.makeDirSync=(t,e)=>(lo(t),co.mkdirSync(t,{mode:uo(e),recursive:!0}))});var he=x((zg,po)=>{"use strict";var Eu=Q().fromPromise,{makeDir:Pu,makeDirSync:En}=fo(),Pn=Eu(Pu);po.exports={mkdirs:Pn,mkdirsSync:En,mkdirp:Pn,mkdirpSync:En,ensureDir:Pn,ensureDirSync:En}});var Re=x((Yg,ho)=>{"use strict";var bu=Q().fromPromise,mo=Qe();function ku(t){return mo.access(t).then(()=>!0).catch(()=>!1)}ho.exports={pathExists:bu(ku),pathExistsSync:mo.existsSync}});var bn=x((Kg,go)=>{"use strict";var ut=ee();function Cu(t,e,r,n){ut.open(t,"r+",(i,o)=>{if(i)return n(i);ut.futimes(o,e,r,s=>{ut.close(o,a=>{n&&n(s||a)})})})}function Lu(t,e,r){let n=ut.openSync(t,"r+");return ut.futimesSync(n,e,r),ut.closeSync(n)}go.exports={utimesMillis:Cu,utimesMillisSync:Lu}});var et=x((Xg,wo)=>{"use strict";var ft=Qe(),q=v("path"),Ou=v("util");function Nu(t,e,r){let n=r.dereference?i=>ft.stat(i,{bigint:!0}):i=>ft.lstat(i,{bigint:!0});return Promise.all([n(t),n(e).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,o])=>({srcStat:i,destStat:o}))}function Iu(t,e,r){let n,i=r.dereference?s=>ft.statSync(s,{bigint:!0}):s=>ft.lstatSync(s,{bigint:!0}),o=i(t);try{n=i(e)}catch(s){if(s.code==="ENOENT")return{srcStat:o,destStat:null};throw s}return{srcStat:o,destStat:n}}function Tu(t,e,r,n,i){Ou.callbackify(Nu)(t,e,n,(o,s)=>{if(o)return i(o);let{srcStat:a,destStat:c}=s;if(c){if(Lt(a,c)){let u=q.basename(t),l=q.basename(e);return r==="move"&&u!==l&&u.toLowerCase()===l.toLowerCase()?i(null,{srcStat:a,destStat:c,isChangingCase:!0}):i(new Error("Source and destination must not be the same."))}if(a.isDirectory()&&!c.isDirectory())return i(new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`));if(!a.isDirectory()&&c.isDirectory())return i(new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`))}return a.isDirectory()&&kn(t,e)?i(new Error(mr(t,e,r))):i(null,{srcStat:a,destStat:c})})}function Mu(t,e,r,n){let{srcStat:i,destStat:o}=Iu(t,e,n);if(o){if(Lt(i,o)){let s=q.basename(t),a=q.basename(e);if(r==="move"&&s!==a&&s.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:o,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!o.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&o.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&kn(t,e))throw new Error(mr(t,e,r));return{srcStat:i,destStat:o}}function yo(t,e,r,n,i){let o=q.resolve(q.dirname(t)),s=q.resolve(q.dirname(r));if(s===o||s===q.parse(s).root)return i();ft.stat(s,{bigint:!0},(a,c)=>a?a.code==="ENOENT"?i():i(a):Lt(e,c)?i(new Error(mr(t,r,n))):yo(t,e,s,n,i))}function _o(t,e,r,n){let i=q.resolve(q.dirname(t)),o=q.resolve(q.dirname(r));if(o===i||o===q.parse(o).root)return;let s;try{s=ft.statSync(o,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(Lt(e,s))throw new Error(mr(t,r,n));return _o(t,e,o,n)}function Lt(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}function kn(t,e){let r=q.resolve(t).split(q.sep).filter(i=>i),n=q.resolve(e).split(q.sep).filter(i=>i);return r.reduce((i,o,s)=>i&&n[s]===o,!0)}function mr(t,e,r){return`Cannot ${r} '${t}' to a subdirectory of itself, '${e}'.`}wo.exports={checkPaths:Tu,checkPathsSync:Mu,checkParentPaths:yo,checkParentPathsSync:_o,isSrcSubdir:kn,areIdentical:Lt}});var bo=x((Zg,Po)=>{"use strict";var te=ee(),Ot=v("path"),Du=he().mkdirs,Fu=Re().pathExists,Au=bn().utimesMillis,Nt=et();function $u(t,e,r,n){typeof r=="function"&&!n?(n=r,r={}):typeof r=="function"&&(r={filter:r}),n=n||function(){},r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001"),Nt.checkPaths(t,e,"copy",r,(i,o)=>{if(i)return n(i);let{srcStat:s,destStat:a}=o;Nt.checkParentPaths(t,s,e,"copy",c=>{if(c)return n(c);vo(t,e,r,(u,l)=>{if(u)return n(u);if(!l)return n();Ru(a,t,e,r,n)})})})}function Ru(t,e,r,n,i){let o=Ot.dirname(r);Fu(o,(s,a)=>{if(s)return i(s);if(a)return Cn(t,e,r,n,i);Du(o,c=>c?i(c):Cn(t,e,r,n,i))})}function vo(t,e,r,n){if(!r.filter)return n(null,!0);Promise.resolve(r.filter(t,e)).then(i=>n(null,i),i=>n(i))}function Cn(t,e,r,n,i){(n.dereference?te.stat:te.lstat)(e,(s,a)=>s?i(s):a.isDirectory()?Hu(a,t,e,r,n,i):a.isFile()||a.isCharacterDevice()||a.isBlockDevice()?Bu(a,t,e,r,n,i):a.isSymbolicLink()?zu(t,e,r,n,i):a.isSocket()?i(new Error(`Cannot copy a socket file: ${e}`)):a.isFIFO()?i(new Error(`Cannot copy a FIFO pipe: ${e}`)):i(new Error(`Unknown file: ${e}`)))}function Bu(t,e,r,n,i,o){return e?ju(t,r,n,i,o):So(t,r,n,i,o)}function ju(t,e,r,n,i){if(n.overwrite)te.unlink(r,o=>o?i(o):So(t,e,r,n,i));else return n.errorOnExist?i(new Error(`'${r}' already exists`)):i()}function So(t,e,r,n,i){te.copyFile(e,r,o=>o?i(o):n.preserveTimestamps?Uu(t.mode,e,r,i):dr(r,t.mode,i))}function Uu(t,e,r,n){return qu(t)?Wu(r,t,i=>i?n(i):xo(t,e,r,n)):xo(t,e,r,n)}function qu(t){return(t&128)===0}function Wu(t,e,r){return dr(t,e|128,r)}function xo(t,e,r,n){Vu(e,r,i=>i?n(i):dr(r,t,n))}function dr(t,e,r){return te.chmod(t,e,r)}function Vu(t,e,r){te.stat(t,(n,i)=>n?r(n):Au(e,i.atime,i.mtime,r))}function Hu(t,e,r,n,i,o){return e?Eo(r,n,i,o):Gu(t.mode,r,n,i,o)}function Gu(t,e,r,n,i){te.mkdir(r,o=>{if(o)return i(o);Eo(e,r,n,s=>s?i(s):dr(r,t,i))})}function Eo(t,e,r,n){te.readdir(t,(i,o)=>i?n(i):Ln(o,t,e,r,n))}function Ln(t,e,r,n,i){let o=t.pop();return o?Ju(t,o,e,r,n,i):i()}function Ju(t,e,r,n,i,o){let s=Ot.join(r,e),a=Ot.join(n,e);vo(s,a,i,(c,u)=>{if(c)return o(c);if(!u)return Ln(t,r,n,i,o);Nt.checkPaths(s,a,"copy",i,(l,f)=>{if(l)return o(l);let{destStat:p}=f;Cn(p,s,a,i,m=>m?o(m):Ln(t,r,n,i,o))})})}function zu(t,e,r,n,i){te.readlink(e,(o,s)=>{if(o)return i(o);if(n.dereference&&(s=Ot.resolve(process.cwd(),s)),t)te.readlink(r,(a,c)=>a?a.code==="EINVAL"||a.code==="UNKNOWN"?te.symlink(s,r,i):i(a):(n.dereference&&(c=Ot.resolve(process.cwd(),c)),Nt.isSrcSubdir(s,c)?i(new Error(`Cannot copy '${s}' to a subdirectory of itself, '${c}'.`)):Nt.isSrcSubdir(c,s)?i(new Error(`Cannot overwrite '${c}' with '${s}'.`)):Yu(s,r,i)));else return te.symlink(s,r,i)})}function Yu(t,e,r){te.unlink(e,n=>n?r(n):te.symlink(t,e,r))}Po.exports=$u});var No=x((Qg,Oo)=>{"use strict";var X=ee(),It=v("path"),Ku=he().mkdirsSync,Xu=bn().utimesMillisSync,Tt=et();function Zu(t,e,r){typeof r=="function"&&(r={filter:r}),r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:n,destStat:i}=Tt.checkPathsSync(t,e,"copy",r);if(Tt.checkParentPathsSync(t,n,e,"copy"),r.filter&&!r.filter(t,e))return;let o=It.dirname(e);return X.existsSync(o)||Ku(o),ko(i,t,e,r)}function ko(t,e,r,n){let o=(n.dereference?X.statSync:X.lstatSync)(e);if(o.isDirectory())return sf(o,t,e,r,n);if(o.isFile()||o.isCharacterDevice()||o.isBlockDevice())return Qu(o,t,e,r,n);if(o.isSymbolicLink())return lf(t,e,r,n);throw o.isSocket()?new Error(`Cannot copy a socket file: ${e}`):o.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}function Qu(t,e,r,n,i){return e?ef(t,r,n,i):Co(t,r,n,i)}function ef(t,e,r,n){if(n.overwrite)return X.unlinkSync(r),Co(t,e,r,n);if(n.errorOnExist)throw new Error(`'${r}' already exists`)}function Co(t,e,r,n){return X.copyFileSync(e,r),n.preserveTimestamps&&tf(t.mode,e,r),On(r,t.mode)}function tf(t,e,r){return rf(t)&&nf(r,t),of(e,r)}function rf(t){return(t&128)===0}function nf(t,e){return On(t,e|128)}function On(t,e){return X.chmodSync(t,e)}function of(t,e){let r=X.statSync(t);return Xu(e,r.atime,r.mtime)}function sf(t,e,r,n,i){return e?Lo(r,n,i):af(t.mode,r,n,i)}function af(t,e,r,n){return X.mkdirSync(r),Lo(e,r,n),On(r,t)}function Lo(t,e,r){X.readdirSync(t).forEach(n=>cf(n,t,e,r))}function cf(t,e,r,n){let i=It.join(e,t),o=It.join(r,t);if(n.filter&&!n.filter(i,o))return;let{destStat:s}=Tt.checkPathsSync(i,o,"copy",n);return ko(s,i,o,n)}function lf(t,e,r,n){let i=X.readlinkSync(e);if(n.dereference&&(i=It.resolve(process.cwd(),i)),t){let o;try{o=X.readlinkSync(r)}catch(s){if(s.code==="EINVAL"||s.code==="UNKNOWN")return X.symlinkSync(i,r);throw s}if(n.dereference&&(o=It.resolve(process.cwd(),o)),Tt.isSrcSubdir(i,o))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${o}'.`);if(Tt.isSrcSubdir(o,i))throw new Error(`Cannot overwrite '${o}' with '${i}'.`);return uf(i,r)}else return X.symlinkSync(i,r)}function uf(t,e){return X.unlinkSync(e),X.symlinkSync(t,e)}Oo.exports=Zu});var hr=x((ey,Io)=>{"use strict";var ff=Q().fromCallback;Io.exports={copy:ff(bo()),copySync:No()}});var Mt=x((ty,Mo)=>{"use strict";var To=ee(),pf=Q().fromCallback;function mf(t,e){To.rm(t,{recursive:!0,force:!0},e)}function df(t){To.rmSync(t,{recursive:!0,force:!0})}Mo.exports={remove:pf(mf),removeSync:df}});var Uo=x((ry,jo)=>{"use strict";var hf=Q().fromPromise,Ao=Qe(),$o=v("path"),Ro=he(),Bo=Mt(),Do=hf(async function(e){let r;try{r=await Ao.readdir(e)}catch{return Ro.mkdirs(e)}return Promise.all(r.map(n=>Bo.remove($o.join(e,n))))});function Fo(t){let e;try{e=Ao.readdirSync(t)}catch{return Ro.mkdirsSync(t)}e.forEach(r=>{r=$o.join(t,r),Bo.removeSync(r)})}jo.exports={emptyDirSync:Fo,emptydirSync:Fo,emptyDir:Do,emptydir:Do}});var Ho=x((ny,Vo)=>{"use strict";var gf=Q().fromCallback,qo=v("path"),Be=ee(),Wo=he();function yf(t,e){function r(){Be.writeFile(t,"",n=>{if(n)return e(n);e()})}Be.stat(t,(n,i)=>{if(!n&&i.isFile())return e();let o=qo.dirname(t);Be.stat(o,(s,a)=>{if(s)return s.code==="ENOENT"?Wo.mkdirs(o,c=>{if(c)return e(c);r()}):e(s);a.isDirectory()?r():Be.readdir(o,c=>{if(c)return e(c)})})})}function _f(t){let e;try{e=Be.statSync(t)}catch{}if(e&&e.isFile())return;let r=qo.dirname(t);try{Be.statSync(r).isDirectory()||Be.readdirSync(r)}catch(n){if(n&&n.code==="ENOENT")Wo.mkdirsSync(r);else throw n}Be.writeFileSync(t,"")}Vo.exports={createFile:gf(yf),createFileSync:_f}});var Ko=x((iy,Yo)=>{"use strict";var wf=Q().fromCallback,Go=v("path"),je=ee(),Jo=he(),xf=Re().pathExists,{areIdentical:zo}=et();function vf(t,e,r){function n(i,o){je.link(i,o,s=>{if(s)return r(s);r(null)})}je.lstat(e,(i,o)=>{je.lstat(t,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),r(s);if(o&&zo(a,o))return r(null);let c=Go.dirname(e);xf(c,(u,l)=>{if(u)return r(u);if(l)return n(t,e);Jo.mkdirs(c,f=>{if(f)return r(f);n(t,e)})})})})}function Sf(t,e){let r;try{r=je.lstatSync(e)}catch{}try{let o=je.lstatSync(t);if(r&&zo(o,r))return}catch(o){throw o.message=o.message.replace("lstat","ensureLink"),o}let n=Go.dirname(e);return je.existsSync(n)||Jo.mkdirsSync(n),je.linkSync(t,e)}Yo.exports={createLink:wf(vf),createLinkSync:Sf}});var Zo=x((oy,Xo)=>{"use strict";var Ue=v("path"),Dt=ee(),Ef=Re().pathExists;function Pf(t,e,r){if(Ue.isAbsolute(t))return Dt.lstat(t,n=>n?(n.message=n.message.replace("lstat","ensureSymlink"),r(n)):r(null,{toCwd:t,toDst:t}));{let n=Ue.dirname(e),i=Ue.join(n,t);return Ef(i,(o,s)=>o?r(o):s?r(null,{toCwd:i,toDst:t}):Dt.lstat(t,a=>a?(a.message=a.message.replace("lstat","ensureSymlink"),r(a)):r(null,{toCwd:t,toDst:Ue.relative(n,t)})))}}function bf(t,e){let r;if(Ue.isAbsolute(t)){if(r=Dt.existsSync(t),!r)throw new Error("absolute srcpath does not exist");return{toCwd:t,toDst:t}}else{let n=Ue.dirname(e),i=Ue.join(n,t);if(r=Dt.existsSync(i),r)return{toCwd:i,toDst:t};if(r=Dt.existsSync(t),!r)throw new Error("relative srcpath does not exist");return{toCwd:t,toDst:Ue.relative(n,t)}}}Xo.exports={symlinkPaths:Pf,symlinkPathsSync:bf}});var ts=x((sy,es)=>{"use strict";var Qo=ee();function kf(t,e,r){if(r=typeof e=="function"?e:r,e=typeof e=="function"?!1:e,e)return r(null,e);Qo.lstat(t,(n,i)=>{if(n)return r(null,"file");e=i&&i.isDirectory()?"dir":"file",r(null,e)})}function Cf(t,e){let r;if(e)return e;try{r=Qo.lstatSync(t)}catch{return"file"}return r&&r.isDirectory()?"dir":"file"}es.exports={symlinkType:kf,symlinkTypeSync:Cf}});var ls=x((ay,cs)=>{"use strict";var Lf=Q().fromCallback,ns=v("path"),ge=Qe(),is=he(),Of=is.mkdirs,Nf=is.mkdirsSync,os=Zo(),If=os.symlinkPaths,Tf=os.symlinkPathsSync,ss=ts(),Mf=ss.symlinkType,Df=ss.symlinkTypeSync,Ff=Re().pathExists,{areIdentical:as}=et();function Af(t,e,r,n){n=typeof r=="function"?r:n,r=typeof r=="function"?!1:r,ge.lstat(e,(i,o)=>{!i&&o.isSymbolicLink()?Promise.all([ge.stat(t),ge.stat(e)]).then(([s,a])=>{if(as(s,a))return n(null);rs(t,e,r,n)}):rs(t,e,r,n)})}function rs(t,e,r,n){If(t,e,(i,o)=>{if(i)return n(i);t=o.toDst,Mf(o.toCwd,r,(s,a)=>{if(s)return n(s);let c=ns.dirname(e);Ff(c,(u,l)=>{if(u)return n(u);if(l)return ge.symlink(t,e,a,n);Of(c,f=>{if(f)return n(f);ge.symlink(t,e,a,n)})})})})}function $f(t,e,r){let n;try{n=ge.lstatSync(e)}catch{}if(n&&n.isSymbolicLink()){let a=ge.statSync(t),c=ge.statSync(e);if(as(a,c))return}let i=Tf(t,e);t=i.toDst,r=Df(i.toCwd,r);let o=ns.dirname(e);return ge.existsSync(o)||Nf(o),ge.symlinkSync(t,e,r)}cs.exports={createSymlink:Lf(Af),createSymlinkSync:$f}});var ys=x((cy,gs)=>{"use strict";var{createFile:us,createFileSync:fs}=Ho(),{createLink:ps,createLinkSync:ms}=Ko(),{createSymlink:ds,createSymlinkSync:hs}=ls();gs.exports={createFile:us,createFileSync:fs,ensureFile:us,ensureFileSync:fs,createLink:ps,createLinkSync:ms,ensureLink:ps,ensureLinkSync:ms,createSymlink:ds,createSymlinkSync:hs,ensureSymlink:ds,ensureSymlinkSync:hs}});var gr=x((ly,_s)=>{function Rf(t,{EOL:e=`
`,finalEOL:r=!0,replacer:n=null,spaces:i}={}){let o=r?e:"";return JSON.stringify(t,n,i).replace(/\n/g,e)+o}function Bf(t){return Buffer.isBuffer(t)&&(t=t.toString("utf8")),t.replace(/^\uFEFF/,"")}_s.exports={stringify:Rf,stripBom:Bf}});var Ss=x((uy,vs)=>{var pt;try{pt=ee()}catch{pt=v("fs")}var yr=Q(),{stringify:ws,stripBom:xs}=gr();async function jf(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||pt,n="throws"in e?e.throws:!0,i=await yr.fromCallback(r.readFile)(t,e);i=xs(i);let o;try{o=JSON.parse(i,e?e.reviver:null)}catch(s){if(n)throw s.message=`${t}: ${s.message}`,s;return null}return o}var Uf=yr.fromPromise(jf);function qf(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||pt,n="throws"in e?e.throws:!0;try{let i=r.readFileSync(t,e);return i=xs(i),JSON.parse(i,e.reviver)}catch(i){if(n)throw i.message=`${t}: ${i.message}`,i;return null}}async function Wf(t,e,r={}){let n=r.fs||pt,i=ws(e,r);await yr.fromCallback(n.writeFile)(t,i,r)}var Vf=yr.fromPromise(Wf);function Hf(t,e,r={}){let n=r.fs||pt,i=ws(e,r);return n.writeFileSync(t,i,r)}var Gf={readFile:Uf,readFileSync:qf,writeFile:Vf,writeFileSync:Hf};vs.exports=Gf});var Ps=x((fy,Es)=>{"use strict";var _r=Ss();Es.exports={readJson:_r.readFile,readJsonSync:_r.readFileSync,writeJson:_r.writeFile,writeJsonSync:_r.writeFileSync}});var wr=x((py,Cs)=>{"use strict";var Jf=Q().fromCallback,Ft=ee(),bs=v("path"),ks=he(),zf=Re().pathExists;function Yf(t,e,r,n){typeof r=="function"&&(n=r,r="utf8");let i=bs.dirname(t);zf(i,(o,s)=>{if(o)return n(o);if(s)return Ft.writeFile(t,e,r,n);ks.mkdirs(i,a=>{if(a)return n(a);Ft.writeFile(t,e,r,n)})})}function Kf(t,...e){let r=bs.dirname(t);if(Ft.existsSync(r))return Ft.writeFileSync(t,...e);ks.mkdirsSync(r),Ft.writeFileSync(t,...e)}Cs.exports={outputFile:Jf(Yf),outputFileSync:Kf}});var Os=x((my,Ls)=>{"use strict";var{stringify:Xf}=gr(),{outputFile:Zf}=wr();async function Qf(t,e,r={}){let n=Xf(e,r);await Zf(t,n,r)}Ls.exports=Qf});var Is=x((dy,Ns)=>{"use strict";var{stringify:ep}=gr(),{outputFileSync:tp}=wr();function rp(t,e,r){let n=ep(e,r);tp(t,n,r)}Ns.exports=rp});var Ms=x((hy,Ts)=>{"use strict";var np=Q().fromPromise,Z=Ps();Z.outputJson=np(Os());Z.outputJsonSync=Is();Z.outputJSON=Z.outputJson;Z.outputJSONSync=Z.outputJsonSync;Z.writeJSON=Z.writeJson;Z.writeJSONSync=Z.writeJsonSync;Z.readJSON=Z.readJson;Z.readJSONSync=Z.readJsonSync;Ts.exports=Z});var Rs=x((gy,$s)=>{"use strict";var ip=ee(),In=v("path"),op=hr().copy,As=Mt().remove,sp=he().mkdirp,ap=Re().pathExists,Ds=et();function cp(t,e,r,n){typeof r=="function"&&(n=r,r={}),r=r||{};let i=r.overwrite||r.clobber||!1;Ds.checkPaths(t,e,"move",r,(o,s)=>{if(o)return n(o);let{srcStat:a,isChangingCase:c=!1}=s;Ds.checkParentPaths(t,a,e,"move",u=>{if(u)return n(u);if(lp(e))return Fs(t,e,i,c,n);sp(In.dirname(e),l=>l?n(l):Fs(t,e,i,c,n))})})}function lp(t){let e=In.dirname(t);return In.parse(e).root===e}function Fs(t,e,r,n,i){if(n)return Nn(t,e,r,i);if(r)return As(e,o=>o?i(o):Nn(t,e,r,i));ap(e,(o,s)=>o?i(o):s?i(new Error("dest already exists.")):Nn(t,e,r,i))}function Nn(t,e,r,n){ip.rename(t,e,i=>i?i.code!=="EXDEV"?n(i):up(t,e,r,n):n())}function up(t,e,r,n){op(t,e,{overwrite:r,errorOnExist:!0,preserveTimestamps:!0},o=>o?n(o):As(t,n))}$s.exports=cp});var Ws=x((yy,qs)=>{"use strict";var js=ee(),Mn=v("path"),fp=hr().copySync,Us=Mt().removeSync,pp=he().mkdirpSync,Bs=et();function mp(t,e,r){r=r||{};let n=r.overwrite||r.clobber||!1,{srcStat:i,isChangingCase:o=!1}=Bs.checkPathsSync(t,e,"move",r);return Bs.checkParentPathsSync(t,i,e,"move"),dp(e)||pp(Mn.dirname(e)),hp(t,e,n,o)}function dp(t){let e=Mn.dirname(t);return Mn.parse(e).root===e}function hp(t,e,r,n){if(n)return Tn(t,e,r);if(r)return Us(e),Tn(t,e,r);if(js.existsSync(e))throw new Error("dest already exists.");return Tn(t,e,r)}function Tn(t,e,r){try{js.renameSync(t,e)}catch(n){if(n.code!=="EXDEV")throw n;return gp(t,e,r)}}function gp(t,e,r){return fp(t,e,{overwrite:r,errorOnExist:!0,preserveTimestamps:!0}),Us(t)}qs.exports=mp});var Hs=x((_y,Vs)=>{"use strict";var yp=Q().fromCallback;Vs.exports={move:yp(Rs()),moveSync:Ws()}});var G=x((wy,Gs)=>{"use strict";Gs.exports={...Qe(),...hr(),...Uo(),...ys(),...Ms(),...he(),...Hs(),...wr(),...Re(),...Mt()}});var Js,zs=y(()=>{Js=()=>`
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

#cache
.turbo
.next
.vercel

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*


# local env files
.env*

out/
build/
dist/

# plasmo - https://www.plasmo.com
.plasmo

# bpp - http://bpp.browser.market/
keys.json

# typescript
.tsbuildinfo
`});import{userInfo as _p}from"os";import{sentenceCase as wp}from"change-case";import xp from"package-json";var vp,Ys,Dn,Fn=y(()=>{vp=async({name:t="plasmo-extension",version:e="0.0.1",packageManager:r={}})=>{let n={name:t,displayName:wp(t),version:e,description:"A basic Plasmo extension.",author:_p().username,packageManager:void 0,scripts:{dev:"plasmo dev",build:"plasmo build",package:"plasmo package"},dependencies:{plasmo:"workspace:*",react:"*","react-dom":"*"},devDependencies:{"@types/chrome":"*","@types/node":"*","@types/react":"*","@types/react-dom":"*",prettier:"*",typescript:"*"},manifest:{host_permissions:["https://*/*"]}};return!r||!r.version?delete n.packageManager:n.packageManager=`${r.name}@${r.version}`,n},Ys=async t=>await vp(t),Dn=async t=>{let e={};return await Promise.all(Object.entries(t).map(async([r,n])=>{if(r==="plasmo")e[r]="0.89.4";else if(n==="workspace:*")try{let i=await xp(r,{version:"latest"});e[r]=i.version}catch{e[r]=n}else e[r]=n})),e}});import{dirname as Sp,resolve as mt}from"path";import{fileURLToPath as Ep}from"url";var xr,An=y(()=>{xr=()=>{let t=Sp(Ep(import.meta.url)),e=mt(t,"..","templates"),r=mt(e,"static"),n=mt(v.resolve("@plasmohq/init"),".."),i=mt(n,"templates"),o=mt(n,"entries"),s=mt(n,"bpp.yml");return{templatePath:e,initTemplatePath:i,initEntryPath:o,staticTemplatePath:r,bppYaml:s}}});import Pp from"inquirer";var dt,$n=y(()=>{dt=async(t="",e="")=>{let{data:r}=await Pp.prompt({name:"data",prefix:"\u{1F7E1}",message:t,default:e});return r}});import{readFile as bp}from"fs/promises";import{extname as kp}from"path";import{strFromU8 as Cp,unzipSync as Lp}from"fflate";async function Op(t,e,r){if(t.content_security_policy&&(d("Convert content_security_policy"),e.manifest.content_security_policy={extension_pages:t.content_security_policy}),t.web_accessible_resources&&(d("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[{matches:["https://*/*"],resources:t.web_accessible_resources}]),t.permissions){d("Convert permissions"),e.manifest.permissions=[],e.manifest.host_permissions=[];for(let n of t.permissions)n.startsWith("http")||n==="<all_urls>"?e.manifest.host_permissions.push(n):e.manifest.permissions.push(n)}t.browser_action&&(d("Convert browser_action"),e.manifest.action={default_title:t.browser_action.default_title}),t.background&&d("Convert background")}async function Np(t,e,r){t.content_security_policy&&(d("Convert content_security_policy"),e.manifest.content_security_policy={...t.content_security_policy}),t.web_accessible_resources&&(d("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[...t.web_accessible_resources]),t.permissions&&(d("Transfer permissions"),e.manifest.permissions=[...t.permissions]),t.host_permissions&&(d("Transfer host_permissions"),e.manifest.host_permissions=[...t.host_permissions]),t.action&&(d("Convert browser_action"),e.manifest.action={default_title:t.action.default_title}),t.background&&d("Convert background")}var Ks,Xs,Zs,Qs=y(()=>{Ks=A(G(),1);k();Fn();Xs=async t=>{let e={unzipped:{},isZip:!1,manifestData:{}},r=kp(t);if(r===".zip"){let n=await bp(t);e.unzipped=Lp(n),e.isZip=!0,e.manifestData=JSON.parse(Cp(e.unzipped["manifest.json"]))}else if(r===".json")e.manifestData=await(0,Ks.readJson)(t);else return null;return e},Zs=async(t,e,{manifestData:r})=>{let n=await Ys({name:t.packageName,packageManager:e});switch(n.version=r.version,n.displayName=r.name,n.description=r.description,r?.author&&(n.author=r.author),r.homepage_url&&(n.homepage=r.homepage_url),r.version_name&&(n.manifest.version_name=r.version_name),r.browser_specific_settings&&(n.manifest.browser_specific_settings=r.browser_specific_settings),r.default_locale&&d("Convert locale"),r.options_ui&&d("Convert options_ui"),r.chrome_url_overrides&&d("Convert chrome_url_overrides"),r.icons&&d("Convert icons"),r.content_scripts&&d("Convert content_scripts"),r.manifest_version){case 2:await Op(r,n,t);break;case 3:await Np(r,n,t);break;default:throw new Error("Unknown manifest version")}return n}});import{existsSync as ea}from"fs";import{lstat as Ip,readFile as Tp,writeFile as Mp}from"fs/promises";import{isAbsolute as Dp,join as Fp,relative as Ap,resolve as At}from"path";import $p from"@expo/spawn-async";import{sentenceCase as Rp}from"change-case";import Bp from"ignore";import{temporaryDirectory as jp}from"tempy";var ye,Up,vr,ta=y(()=>{ye=A(G(),1);de();Y();k();zs();Fn();An();$n();Qs();Up=/(?:^--with-)(?:\w+-?)+(?:[^-]$)/,vr=class{constructor(e,r,n=!1){this.commonPath=e;this.packageManager=r;this.isExample=n}templatePath=xr();async create(){return await this.createFrom()||await this.createWith()||await this.createBlank()}async createFrom(){let e=V("--from");if(!e)return!1;let r=Dp(e)?e:At(e),n=await Ip(r);return n.isFile()?await this.createFromManifest(r):n.isDirectory()?await this.createFromLocalTemplate(r):!1}async createFromLocalTemplate(e){let r=Bp().add(["node_modules",".git",".env*"]),n=Fp(e,".gitignore");if(await F(n)){let s=await Tp(n,"utf-8");r.add(s)}await(0,ye.copy)(e,this.commonPath.projectDirectory,{filter:s=>s===e||!r.ignores(Ap(e,s))});let o=await(0,ye.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(o),N(`Creating new project from ${e}`),!0}async createFromManifest(e){let r=await Xs(e);if(r===null)return!1;await this.copyBlankInitFiles();let n=await Zs(this.commonPath,this.packageManager,r);return await this.outputPackageData(n,{resolveWorkspaceRefs:!0}),!0}async createWith(){let e=process.argv.find(r=>Up.test(r));return e===void 0?!1:this.createWithExample(e.substring(2))}async createWithExample(e){let r=jp();d(`Download examples to temporary directory: ${r}`);try{await $p("git",["clone","--depth","1","https://github.com/PlasmoHQ/examples.git","."],{cwd:r,ignoreStdio:!0})}catch(o){if(o.errno==="ENOENT")throw new Error("Unable to clone example repo. `git` is not in PATH.")}let n=At(r,e);if(!ea(n))throw new Error(`Example ${e} not found. You may file an example request at: https://docs.plasmo.com/exp`);d("Copy example to project directory"),await Promise.all([(0,ye.copy)(n,this.commonPath.projectDirectory),this.copyBppWorkflow()]);let i=await(0,ye.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(i,{resolveWorkspaceRefs:!0}),N(`Creating new project ${e.split("-").join(" ")}`),!0}async createBlank(){return await this.createWithExample("with-popup"),!0}async outputPackageData(e,{resolveWorkspaceRefs:r=!1}={}){let{packageName:n,packageFilePath:i}=this.commonPath;if(e.name=n,e.displayName=Rp(n),e.description=await dt("Extension description:",e.description),this.isExample)delete e.packageManager,e.contributors=[await dt("Contributor name:",e.author)],e.author="Plasmo Corp. <foss@plasmo.com>";else if(delete e.contributors,e.author=await dt("Author name:",e.author),r){d("Replace workspace refs with the latest package version from npm registry");let o=await Promise.all([Dn(e.dependencies),Dn(e.devDependencies)]);e.dependencies=o[0],e.devDependencies=o[1]}await(0,ye.outputJson)(i,e,{spaces:2})}async copyBlankInitFiles(){let r=(V("--entry")||"popup").split(new RegExp(",|\\s")).flatMap(n=>[`${n}.ts`,`${n}.tsx`]).map(n=>[At(this.templatePath.initEntryPath,n),At(this.commonPath.projectDirectory,n)]).filter(([n])=>ea(n));d("Using the following entry files: ",r),await Promise.all([(0,ye.copy)(this.templatePath.initTemplatePath,this.commonPath.projectDirectory),this.copyBppWorkflow(),Mp(this.commonPath.gitIgnorePath,Js())]),await Promise.all(r.map(([n,i])=>(0,ye.copy)(n,i)))}async copyBppWorkflow(){if(this.isExample||$("--no-bpp"))return;d("Copying BPP workflow...");let e=At(this.commonPath.projectDirectory,".github","workflows","submit.yml");return(0,ye.copy)(this.templatePath.bppYaml,e)}}});import{createQuestId as qp}from"mnemonic-id";var ra,na=y(()=>{rr();k();$n();ra=async()=>{let[t]=tr("init");return t?(d("Using user-provided name:",t),t):(d("Prompting for the extension name"),await dt("Extension name:",qp()))}});import Sr from"@expo/spawn-async";async function ia(t,e){if(!await F(t.gitIgnorePath))return!1;try{return await Wp(e)}catch(r){return j(r.message),!1}}var Wp,oa=y(()=>{Y();k();Wp=async t=>{let{default:e}=await import("chalk"),r={cwd:t,ignoreStdio:!0};try{return d("Checking if the root is a git repository"),await Sr("git",["rev-parse","--is-inside-work-tree"],r),d(`${t} is a git repository, bailing ${e.bold("git init")}`),!1}catch(n){if(n.errno==="ENOENT")throw new Error("Unable to initialize git repo. `git` not in PATH.")}return N("Initializing git project..."),await Sr("git",["init"],r),await Sr("git",["add","--all"],r),await Sr("git",["commit","-m","Created a new Plasmo extension"],r),d("Added all files to git and created the initial commit."),!0}});import Vp from"@expo/spawn-async";var sa,aa=y(()=>{k();sa=async(t,e)=>{try{N("Installing dependencies..."),await Vp(e.name,["install"],{cwd:t,stdio:"inherit"})}catch(r){j(r.message)}}});var ca,la=y(()=>{k();ca=async(t,e,r,n)=>{let{default:i}=await import("chalk");Fe("Your extension is ready in: ",i.yellowBright(t),`

    To start hacking, run:

`,t===e?"":`      cd ${r.packageName}
`,`      ${n.name} ${n.name==="npm"?"run dev":"dev"}
`,`
    Visit https://docs.plasmo.com for documentation and more examples.`)}});var ua={};Ke(ua,{default:()=>Yp});import{resolve as Hp}from"path";import{cwd as Gp}from"process";import{kebabCase as Jp}from"change-case";async function zp(){ue();let t=$("--exp"),e=await ra(),r=Gp(),n=Hp(r,Jp(e)||e);d("Project directory:",n);let i=at(n);if(d("Package name:",i.packageName),t&&!i.packageName.startsWith("with-"))throw new Error("Example extensions must have the `with-` prefix");await zi(n);let o=await ct();d(`Using package manager: ${o.name} ${o?.version}`),await new vr(i,o,t).create(),await sa(n,o),await ia(i,n),await ca(n,r,i,o)}var Yp,fa=y(()=>{de();Y();k();ar();cr();Xe();ta();na();oa();aa();la();Yp=zp});var ha=x((C_,da)=>{"use strict";var{Duplex:Kp}=v("stream");function pa(t){t.emit("close")}function Xp(){!this.destroyed&&this._writableState.finished&&this.destroy()}function ma(t){this.removeListener("error",ma),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function Zp(t,e){let r=!0,n=new Kp({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(o,s){let a=!s&&n._readableState.objectMode?o.toString():o;n.push(a)||t.pause()}),t.once("error",function(o){n.destroyed||(r=!1,n.destroy(o))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(i,o){if(t.readyState===t.CLOSED){o(i),process.nextTick(pa,n);return}let s=!1;t.once("error",function(c){s=!0,o(c)}),t.once("close",function(){s||o(i),process.nextTick(pa,n)}),r&&t.terminate()},n._final=function(i){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(i)});return}t._socket!==null&&(t._socket._writableState.finished?(i(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){i()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(i,o,s){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(i,o,s)});return}t.send(i,s)},n.on("end",Xp),n.on("error",ma),n}da.exports=Zp});var qe=x((L_,ga)=>{"use strict";ga.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var $t=x((O_,Er)=>{"use strict";var{EMPTY_BUFFER:Qp}=qe(),Rn=Buffer[Symbol.species];function em(t,e){if(t.length===0)return Qp;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let i=0;i<t.length;i++){let o=t[i];r.set(o,n),n+=o.length}return n<e?new Rn(r.buffer,r.byteOffset,n):r}function ya(t,e,r,n,i){for(let o=0;o<i;o++)r[n+o]=t[o]^e[o&3]}function _a(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function tm(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function Bn(t){if(Bn.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new Rn(t):ArrayBuffer.isView(t)?e=new Rn(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),Bn.readOnly=!1),e}Er.exports={concat:em,mask:ya,toArrayBuffer:tm,toBuffer:Bn,unmask:_a};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=v("bufferutil");Er.exports.mask=function(e,r,n,i,o){o<48?ya(e,r,n,i,o):t.mask(e,r,n,i,o)},Er.exports.unmask=function(e,r){e.length<32?_a(e,r):t.unmask(e,r)}}catch{}});var va=x((N_,xa)=>{"use strict";var wa=Symbol("kDone"),jn=Symbol("kRun"),Un=class{constructor(e){this[wa]=()=>{this.pending--,this[jn]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[jn]()}[jn](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[wa])}}};xa.exports=Un});var jt=x((I_,ba)=>{"use strict";var Rt=v("zlib"),Sa=$t(),rm=va(),{kStatusCode:Ea}=qe(),nm=Buffer[Symbol.species],im=Buffer.from([0,0,255,255]),kr=Symbol("permessage-deflate"),Ce=Symbol("total-length"),Bt=Symbol("callback"),We=Symbol("buffers"),br=Symbol("error"),Pr,qn=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Pr){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Pr=new rm(i)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Bt];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(i=>!(r.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>i.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let i=r[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=i})}),e}decompress(e,r,n){Pr.add(i=>{this._decompress(e,r,(o,s)=>{i(),n(o,s)})})}compress(e,r,n){Pr.add(i=>{this._compress(e,r,(o,s)=>{i(),n(o,s)})})}_decompress(e,r,n){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Rt.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=Rt.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[kr]=this,this._inflate[Ce]=0,this._inflate[We]=[],this._inflate.on("error",sm),this._inflate.on("data",Pa)}this._inflate[Bt]=n,this._inflate.write(e),r&&this._inflate.write(im),this._inflate.flush(()=>{let o=this._inflate[br];if(o){this._inflate.close(),this._inflate=null,n(o);return}let s=Sa.concat(this._inflate[We],this._inflate[Ce]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Ce]=0,this._inflate[We]=[],r&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),n(null,s)})}_compress(e,r,n){let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Rt.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=Rt.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[Ce]=0,this._deflate[We]=[],this._deflate.on("data",om)}this._deflate[Bt]=n,this._deflate.write(e),this._deflate.flush(Rt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let o=Sa.concat(this._deflate[We],this._deflate[Ce]);r&&(o=new nm(o.buffer,o.byteOffset,o.length-4)),this._deflate[Bt]=null,this._deflate[Ce]=0,this._deflate[We]=[],r&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),n(null,o)})}};ba.exports=qn;function om(t){this[We].push(t),this[Ce]+=t.length}function Pa(t){if(this[Ce]+=t.length,this[kr]._maxPayload<1||this[Ce]<=this[kr]._maxPayload){this[We].push(t);return}this[br]=new RangeError("Max payload size exceeded"),this[br].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[br][Ea]=1009,this.removeListener("data",Pa),this.reset()}function sm(t){this[kr]._inflate=null,t[Ea]=1007,this[Bt](t)}});var Ut=x((T_,Cr)=>{"use strict";var{isUtf8:ka}=v("buffer"),am=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function cm(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function Wn(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}Cr.exports={isValidStatusCode:cm,isValidUTF8:Wn,tokenChars:am};if(ka)Cr.exports.isValidUTF8=function(t){return t.length<24?Wn(t):ka(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=v("utf-8-validate");Cr.exports.isValidUTF8=function(e){return e.length<32?Wn(e):t(e)}}catch{}});var zn=x((M_,Ma)=>{"use strict";var{Writable:lm}=v("stream"),Ca=jt(),{BINARY_TYPES:um,EMPTY_BUFFER:La,kStatusCode:fm,kWebSocket:pm}=qe(),{concat:Vn,toArrayBuffer:mm,unmask:dm}=$t(),{isValidStatusCode:hm,isValidUTF8:Oa}=Ut(),Lr=Buffer[Symbol.species],fe=0,Na=1,Ia=2,Ta=3,Hn=4,Gn=5,Or=6,Jn=class extends lm{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||um[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[pm]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=fe}_write(e,r,n){if(this._opcode===8&&this._state==fe)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Lr(n.buffer,n.byteOffset+e,n.length-e),new Lr(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],i=r.length-e;e>=n.length?r.set(this._buffers.shift(),i):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),i),this._buffers[0]=new Lr(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case fe:this.getInfo(e);break;case Na:this.getPayloadLength16(e);break;case Ia:this.getPayloadLength64(e);break;case Ta:this.getMask();break;case Hn:this.getData(e);break;case Gn:case Or:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if(r[0]&48){let i=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(i);return}let n=(r[0]&64)===64;if(n&&!this._extensions[Ca.extensionName]){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(!this._fragmented){let i=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let i=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(i);return}if(n){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let i=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(i);return}}else{let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let i=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(i);return}}else if(this._masked){let i=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(i);return}this._payloadLength===126?this._state=Na:this._payloadLength===127?this._state=Ia:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,53-32)-1){let i=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(i);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=Ta:this._state=Hn}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Hn}getData(e){let r=La;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&dm(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=Gn,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[Ca.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return r(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(s);return}this._fragments.push(o)}this.dataMessage(r),this._state===fe&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=fe;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=Vn(n,r):this._binaryType==="arraybuffer"?i=mm(Vn(n,r)):i=n,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=fe):(this._state=Or,setImmediate(()=>{this.emit("message",i,!0),this._state=fe,this.startLoop(e)}))}else{let i=Vn(n,r);if(!this._skipUTF8Validation&&!Oa(i)){let o=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(o);return}this._state===Gn||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=fe):(this._state=Or,setImmediate(()=>{this.emit("message",i,!1),this._state=fe,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,La),this.end();else{let n=e.readUInt16BE(0);if(!hm(n)){let o=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(o);return}let i=new Lr(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Oa(i)){let o=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(o);return}this._loop=!1,this.emit("conclude",n,i),this.end()}this._state=fe;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=fe):(this._state=Or,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=fe,this.startLoop(r)}))}createError(e,r,n,i,o){this._loop=!1,this._errored=!0;let s=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(s,this.createError),s.code=o,s[fm]=i,s}};Ma.exports=Jn});var Kn=x((F_,Aa)=>{"use strict";var{Duplex:D_}=v("stream"),{randomFillSync:gm}=v("crypto"),Da=jt(),{EMPTY_BUFFER:ym}=qe(),{isValidStatusCode:_m}=Ut(),{mask:Fa,toBuffer:ht}=$t(),_e=Symbol("kByteLength"),wm=Buffer.alloc(4),Nr=8*1024,tt,gt=Nr,Yn=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,r){let n,i=!1,o=2,s=!1;r.mask&&(n=r.maskBuffer||wm,r.generateMask?r.generateMask(n):(gt===Nr&&(tt===void 0&&(tt=Buffer.alloc(Nr)),gm(tt,0,Nr),gt=0),n[0]=tt[gt++],n[1]=tt[gt++],n[2]=tt[gt++],n[3]=tt[gt++]),s=(n[0]|n[1]|n[2]|n[3])===0,o=6);let a;typeof e=="string"?(!r.mask||s)&&r[_e]!==void 0?a=r[_e]:(e=Buffer.from(e),a=e.length):(a=e.length,i=r.mask&&r.readOnly&&!s);let c=a;a>=65536?(o+=8,c=127):a>125&&(o+=2,c=126);let u=Buffer.allocUnsafe(i?a+o:o);return u[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(u[0]|=64),u[1]=c,c===126?u.writeUInt16BE(a,2):c===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),r.mask?(u[1]|=128,u[o-4]=n[0],u[o-3]=n[1],u[o-2]=n[2],u[o-1]=n[3],s?[u,e]:i?(Fa(e,n,u,o,a),[u]):(Fa(e,n,e,0,a),[u,e])):[u,e]}close(e,r,n,i){let o;if(e===void 0)o=ym;else{if(typeof e!="number"||!_m(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");o=Buffer.allocUnsafe(2+a),o.writeUInt16BE(e,0),typeof r=="string"?o.write(r,2):o.set(r,2)}}let s={[_e]:o.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,o,!1,s,i]):this.sendFrame(t.frame(o,s),i)}ping(e,r,n){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):(e=ht(e),i=e.length,o=ht.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[_e]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:o,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}pong(e,r,n){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):(e=ht(e),i=e.length,o=ht.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[_e]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:o,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}send(e,r,n){let i=this._extensions[Da.extensionName],o=r.binary?2:1,s=r.compress,a,c;if(typeof e=="string"?(a=Buffer.byteLength(e),c=!1):(e=ht(e),a=e.length,c=ht.readOnly),this._firstFragment?(this._firstFragment=!1,s&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=a>=i._threshold),this._compress=s):(s=!1,o=0),r.fin&&(this._firstFragment=!0),i){let u={[_e]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:c,rsv1:s};this._deflating?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}else this.sendFrame(t.frame(e,{[_e]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:c,rsv1:!1}),n)}dispatch(e,r,n,i){if(!r){this.sendFrame(t.frame(e,n),i);return}let o=this._extensions[Da.extensionName];this._bufferedBytes+=n[_e],this._deflating=!0,o.compress(e,n.fin,(s,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");typeof i=="function"&&i(c);for(let u=0;u<this._queue.length;u++){let l=this._queue[u],f=l[l.length-1];typeof f=="function"&&f(c)}return}this._bufferedBytes-=n[_e],this._deflating=!1,n.readOnly=!1,this.sendFrame(t.frame(a,n),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][_e],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][_e],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};Aa.exports=Yn});var Ha=x((A_,Va)=>{"use strict";var{kForOnEventAttribute:qt,kListener:Xn}=qe(),$a=Symbol("kCode"),Ra=Symbol("kData"),Ba=Symbol("kError"),ja=Symbol("kMessage"),Ua=Symbol("kReason"),yt=Symbol("kTarget"),qa=Symbol("kType"),Wa=Symbol("kWasClean"),Le=class{constructor(e){this[yt]=null,this[qa]=e}get target(){return this[yt]}get type(){return this[qa]}};Object.defineProperty(Le.prototype,"target",{enumerable:!0});Object.defineProperty(Le.prototype,"type",{enumerable:!0});var rt=class extends Le{constructor(e,r={}){super(e),this[$a]=r.code===void 0?0:r.code,this[Ua]=r.reason===void 0?"":r.reason,this[Wa]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[$a]}get reason(){return this[Ua]}get wasClean(){return this[Wa]}};Object.defineProperty(rt.prototype,"code",{enumerable:!0});Object.defineProperty(rt.prototype,"reason",{enumerable:!0});Object.defineProperty(rt.prototype,"wasClean",{enumerable:!0});var _t=class extends Le{constructor(e,r={}){super(e),this[Ba]=r.error===void 0?null:r.error,this[ja]=r.message===void 0?"":r.message}get error(){return this[Ba]}get message(){return this[ja]}};Object.defineProperty(_t.prototype,"error",{enumerable:!0});Object.defineProperty(_t.prototype,"message",{enumerable:!0});var Wt=class extends Le{constructor(e,r={}){super(e),this[Ra]=r.data===void 0?null:r.data}get data(){return this[Ra]}};Object.defineProperty(Wt.prototype,"data",{enumerable:!0});var xm={addEventListener(t,e,r={}){for(let i of this.listeners(t))if(!r[qt]&&i[Xn]===e&&!i[qt])return;let n;if(t==="message")n=function(o,s){let a=new Wt("message",{data:s?o:o.toString()});a[yt]=this,Ir(e,this,a)};else if(t==="close")n=function(o,s){let a=new rt("close",{code:o,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[yt]=this,Ir(e,this,a)};else if(t==="error")n=function(o){let s=new _t("error",{error:o,message:o.message});s[yt]=this,Ir(e,this,s)};else if(t==="open")n=function(){let o=new Le("open");o[yt]=this,Ir(e,this,o)};else return;n[qt]=!!r[qt],n[Xn]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[Xn]===e&&!r[qt]){this.removeListener(t,r);break}}};Va.exports={CloseEvent:rt,ErrorEvent:_t,Event:Le,EventTarget:xm,MessageEvent:Wt};function Ir(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var Zn=x(($_,Ga)=>{"use strict";var{tokenChars:Vt}=Ut();function Se(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function vm(t){let e=Object.create(null),r=Object.create(null),n=!1,i=!1,o=!1,s,a,c=-1,u=-1,l=-1,f=0;for(;f<t.length;f++)if(u=t.charCodeAt(f),s===void 0)if(l===-1&&Vt[u]===1)c===-1&&(c=f);else if(f!==0&&(u===32||u===9))l===-1&&c!==-1&&(l=f);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${f}`);l===-1&&(l=f);let m=t.slice(c,l);u===44?(Se(e,m,r),r=Object.create(null)):s=m,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);else if(a===void 0)if(l===-1&&Vt[u]===1)c===-1&&(c=f);else if(u===32||u===9)l===-1&&c!==-1&&(l=f);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${f}`);l===-1&&(l=f),Se(r,t.slice(c,l),!0),u===44&&(Se(e,s,r),r=Object.create(null),s=void 0),c=l=-1}else if(u===61&&c!==-1&&l===-1)a=t.slice(c,f),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(i){if(Vt[u]!==1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1?c=f:n||(n=!0),i=!1}else if(o)if(Vt[u]===1)c===-1&&(c=f);else if(u===34&&c!==-1)o=!1,l=f;else if(u===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(u===34&&t.charCodeAt(f-1)===61)o=!0;else if(l===-1&&Vt[u]===1)c===-1&&(c=f);else if(c!==-1&&(u===32||u===9))l===-1&&(l=f);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${f}`);l===-1&&(l=f);let m=t.slice(c,l);n&&(m=m.replace(/\\/g,""),n=!1),Se(r,a,m),u===44&&(Se(e,s,r),r=Object.create(null),s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);if(c===-1||o||u===32||u===9)throw new SyntaxError("Unexpected end of input");l===-1&&(l=f);let p=t.slice(c,l);return s===void 0?Se(e,p,r):(a===void 0?Se(r,p,!0):n?Se(r,a,p.replace(/\\/g,"")):Se(r,a,p),Se(e,s,r)),e}function Sm(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(i=>{let o=n[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Ga.exports={format:Sm,parse:vm}});var ni=x((j_,nc)=>{"use strict";var Em=v("events"),Pm=v("https"),bm=v("http"),Ya=v("net"),km=v("tls"),{randomBytes:Cm,createHash:Lm}=v("crypto"),{Duplex:R_,Readable:B_}=v("stream"),{URL:Qn}=v("url"),Ve=jt(),Om=zn(),Nm=Kn(),{BINARY_TYPES:Ja,EMPTY_BUFFER:Tr,GUID:Im,kForOnEventAttribute:ei,kListener:Tm,kStatusCode:Mm,kWebSocket:z,NOOP:Ka}=qe(),{EventTarget:{addEventListener:Dm,removeEventListener:Fm}}=Ha(),{format:Am,parse:$m}=Zn(),{toBuffer:Rm}=$t(),Bm=30*1e3,Xa=Symbol("kAborted"),ti=[8,13],Oe=["CONNECTING","OPEN","CLOSING","CLOSED"],jm=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,R=class t extends Em{constructor(e,r,n){super(),this._binaryType=Ja[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Tr,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),Za(this,e,r,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Ja.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let i=new Om({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation});this._sender=new Nm(e,this._extensions,n.generateMask),this._receiver=i,this._socket=e,i[z]=this,e[z]=this,i.on("conclude",Wm),i.on("drain",Vm),i.on("error",Hm),i.on("message",Gm),i.on("ping",Jm),i.on("pong",zm),e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",ec),e.on("data",Dr),e.on("end",tc),e.on("error",rc),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Ve.extensionName]&&this._extensions[Ve.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){let n="WebSocket was closed before the connection was established";se(this,this._req,n);return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Bm)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){ri(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Tr,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){ri(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Tr,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){ri(this,e,n);return}let i={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[Ve.extensionName]||(i.compress=!1),this._sender.send(e||Tr,i,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){let e="WebSocket was closed before the connection was established";se(this,this._req,e);return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(R,"CONNECTING",{enumerable:!0,value:Oe.indexOf("CONNECTING")});Object.defineProperty(R.prototype,"CONNECTING",{enumerable:!0,value:Oe.indexOf("CONNECTING")});Object.defineProperty(R,"OPEN",{enumerable:!0,value:Oe.indexOf("OPEN")});Object.defineProperty(R.prototype,"OPEN",{enumerable:!0,value:Oe.indexOf("OPEN")});Object.defineProperty(R,"CLOSING",{enumerable:!0,value:Oe.indexOf("CLOSING")});Object.defineProperty(R.prototype,"CLOSING",{enumerable:!0,value:Oe.indexOf("CLOSING")});Object.defineProperty(R,"CLOSED",{enumerable:!0,value:Oe.indexOf("CLOSED")});Object.defineProperty(R.prototype,"CLOSED",{enumerable:!0,value:Oe.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(R.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(R.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[ei])return e[Tm];return null},set(e){for(let r of this.listeners(t))if(r[ei]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[ei]:!0})}})});R.prototype.addEventListener=Dm;R.prototype.removeEventListener=Fm;nc.exports=R;function Za(t,e,r,n){let i={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:ti[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=i.autoPong,!ti.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${ti.join(", ")})`);let o;if(e instanceof Qn)o=e;else try{o=new Qn(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}o.protocol==="http:"?o.protocol="ws:":o.protocol==="https:"&&(o.protocol="wss:"),t._url=o.href;let s=o.protocol==="wss:",a=o.protocol==="ws+unix:",c;if(o.protocol!=="ws:"&&!s&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!o.pathname?c="The URL's pathname is empty":o.hash&&(c="The URL contains a fragment identifier"),c){let g=new SyntaxError(c);if(t._redirects===0)throw g;Mr(t,g);return}let u=s?443:80,l=Cm(16).toString("base64"),f=s?Pm.request:bm.request,p=new Set,m;if(i.createConnection=i.createConnection||(s?qm:Um),i.defaultPort=i.defaultPort||u,i.port=o.port||u,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},i.path=o.pathname+o.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(m=new Ve(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=Am({[Ve.extensionName]:m.offer()})),r.length){for(let g of r){if(typeof g!="string"||!jm.test(g)||p.has(g))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(g)}i.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),a){let g=i.path.split(":");i.socketPath=g[0],i.path=g[1]}let h;if(i.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=s,t._originalHostOrSocketPath=a?i.socketPath:o.host;let g=n&&n.headers;if(n={...n,headers:{}},g)for(let[_,S]of Object.entries(g))n.headers[_.toLowerCase()]=S}else if(t.listenerCount("redirect")===0){let g=a?t._originalIpc?i.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:o.host===t._originalHostOrSocketPath;(!g||t._originalSecure&&!s)&&(delete i.headers.authorization,delete i.headers.cookie,g||delete i.headers.host,i.auth=void 0)}i.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),h=t._req=f(i),t._redirects&&t.emit("redirect",t.url,h)}else h=t._req=f(i);i.timeout&&h.on("timeout",()=>{se(t,h,"Opening handshake has timed out")}),h.on("error",g=>{h===null||h[Xa]||(h=t._req=null,Mr(t,g))}),h.on("response",g=>{let _=g.headers.location,S=g.statusCode;if(_&&i.followRedirects&&S>=300&&S<400){if(++t._redirects>i.maxRedirects){se(t,h,"Maximum redirects exceeded");return}h.abort();let C;try{C=new Qn(_,e)}catch{let J=new SyntaxError(`Invalid URL: ${_}`);Mr(t,J);return}Za(t,C,r,n)}else t.emit("unexpected-response",h,g)||se(t,h,`Unexpected server response: ${g.statusCode}`)}),h.on("upgrade",(g,_,S)=>{if(t.emit("upgrade",g),t.readyState!==R.CONNECTING)return;h=t._req=null;let C=g.headers.upgrade;if(C===void 0||C.toLowerCase()!=="websocket"){se(t,_,"Invalid Upgrade header");return}let I=Lm("sha1").update(l+Im).digest("base64");if(g.headers["sec-websocket-accept"]!==I){se(t,_,"Invalid Sec-WebSocket-Accept header");return}let J=g.headers["sec-websocket-protocol"],me;if(J!==void 0?p.size?p.has(J)||(me="Server sent an invalid subprotocol"):me="Server sent a subprotocol but none was requested":p.size&&(me="Server sent no subprotocol"),me){se(t,_,me);return}J&&(t._protocol=J);let Te=g.headers["sec-websocket-extensions"];if(Te!==void 0){if(!m){se(t,_,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Me;try{Me=$m(Te)}catch{se(t,_,"Invalid Sec-WebSocket-Extensions header");return}let be=Object.keys(Me);if(be.length!==1||be[0]!==Ve.extensionName){se(t,_,"Server indicated an extension that was not requested");return}try{m.accept(Me[Ve.extensionName])}catch{se(t,_,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[Ve.extensionName]=m}t.setSocket(_,S,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(h,t):h.end()}function Mr(t,e){t._readyState=R.CLOSING,t.emit("error",e),t.emitClose()}function Um(t){return t.path=t.socketPath,Ya.connect(t)}function qm(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=Ya.isIP(t.host)?"":t.host),km.connect(t)}function se(t,e,r){t._readyState=R.CLOSING;let n=new Error(r);Error.captureStackTrace(n,se),e.setHeader?(e[Xa]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Mr,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function ri(t,e,r){if(e){let n=Rm(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${Oe[t.readyState]})`);process.nextTick(r,n)}}function Wm(t,e){let r=this[z];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[z]!==void 0&&(r._socket.removeListener("data",Dr),process.nextTick(Qa,r._socket),t===1005?r.close():r.close(t,e))}function Vm(){let t=this[z];t.isPaused||t._socket.resume()}function Hm(t){let e=this[z];e._socket[z]!==void 0&&(e._socket.removeListener("data",Dr),process.nextTick(Qa,e._socket),e.close(t[Mm])),e.emit("error",t)}function za(){this[z].emitClose()}function Gm(t,e){this[z].emit("message",t,e)}function Jm(t){let e=this[z];e._autoPong&&e.pong(t,!this._isServer,Ka),e.emit("ping",t)}function zm(t){this[z].emit("pong",t)}function Qa(t){t.resume()}function ec(){let t=this[z];this.removeListener("close",ec),this.removeListener("data",Dr),this.removeListener("end",tc),t._readyState=R.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[z]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",za),t._receiver.on("finish",za))}function Dr(t){this[z]._receiver.write(t)||this.pause()}function tc(){let t=this[z];t._readyState=R.CLOSING,t._receiver.end(),this.end()}function rc(){let t=this[z];this.removeListener("error",rc),this.on("error",Ka),t&&(t._readyState=R.CLOSING,this.destroy())}});var oc=x((U_,ic)=>{"use strict";var{tokenChars:Ym}=Ut();function Km(t){let e=new Set,r=-1,n=-1,i=0;for(i;i<t.length;i++){let s=t.charCodeAt(i);if(n===-1&&Ym[s]===1)r===-1&&(r=i);else if(i!==0&&(s===32||s===9))n===-1&&r!==-1&&(n=i);else if(s===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${i}`);n===-1&&(n=i);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${i}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let o=t.slice(r,i);if(e.has(o))throw new SyntaxError(`The "${o}" subprotocol is duplicated`);return e.add(o),e}ic.exports={parse:Km}});var pc=x((W_,fc)=>{"use strict";var Xm=v("events"),Fr=v("http"),{Duplex:q_}=v("stream"),{createHash:Zm}=v("crypto"),sc=Zn(),nt=jt(),Qm=oc(),ed=ni(),{GUID:td,kWebSocket:rd}=qe(),nd=/^[+/0-9A-Za-z]{22}==$/,ac=0,cc=1,uc=2,ii=class extends Xm{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:ed,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Fr.createServer((n,i)=>{let o=Fr.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=id(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,o,s)=>{this.handleUpgrade(i,o,s,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=ac}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===uc){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Ht,this);return}if(e&&this.once("close",e),this._state!==cc)if(this._state=cc,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Ht,this):process.nextTick(Ht,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Ht(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,i){r.on("error",lc);let o=e.headers["sec-websocket-key"],s=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){it(this,e,r,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){it(this,e,r,400,"Invalid Upgrade header");return}if(o===void 0||!nd.test(o)){it(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){it(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){Gt(r,400);return}let c=e.headers["sec-websocket-protocol"],u=new Set;if(c!==void 0)try{u=Qm.parse(c)}catch{it(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let l=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&l!==void 0){let p=new nt(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let m=sc.parse(l);m[nt.extensionName]&&(p.accept(m[nt.extensionName]),f[nt.extensionName]=p)}catch{it(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let p={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(p,(m,h,g,_)=>{if(!m)return Gt(r,h||401,g,_);this.completeUpgrade(f,o,u,e,r,n,i)});return}if(!this.options.verifyClient(p))return Gt(r,401)}this.completeUpgrade(f,o,u,e,r,n,i)}completeUpgrade(e,r,n,i,o,s,a){if(!o.readable||!o.writable)return o.destroy();if(o[rd])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>ac)return Gt(o,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Zm("sha1").update(r+td).digest("base64")}`],l=new this.options.WebSocket(null,void 0,this.options);if(n.size){let f=this.options.handleProtocols?this.options.handleProtocols(n,i):n.values().next().value;f&&(u.push(`Sec-WebSocket-Protocol: ${f}`),l._protocol=f)}if(e[nt.extensionName]){let f=e[nt.extensionName].params,p=sc.format({[nt.extensionName]:[f]});u.push(`Sec-WebSocket-Extensions: ${p}`),l._extensions=e}this.emit("headers",u,i),o.write(u.concat(`\r
`).join(`\r
`)),o.removeListener("error",lc),l.setSocket(o,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(l),l.on("close",()=>{this.clients.delete(l),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Ht,this)})),a(l,i)}};fc.exports=ii;function id(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function Ht(t){t._state=uc,t.emit("close")}function lc(){this.destroy()}function Gt(t,e,r,n){r=r||Fr.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${Fr.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+r)}function it(t,e,r,n,i){if(t.listenerCount("wsClientError")){let o=new Error(i);Error.captureStackTrace(o,it),t.emit("wsClientError",o,r,e)}else Gt(r,n,i)}});var od,sd,ad,oi,si,mc=y(()=>{od=A(ha(),1),sd=A(zn(),1),ad=A(Kn(),1),oi=A(ni(),1),si=A(pc(),1)});var dc=y(()=>{});var cd,Ar,ai,gc,ci=y(()=>{mc();dc();cd=(t,e)=>{let r=new si.default({host:t,port:e+1});return{broadcast:i=>{for(let o of r.clients)o.readyState===oi.default.OPEN&&o.send(JSON.stringify({type:i}))}}},ai=(t="localhost",e)=>{if(process.env.NODE_ENV==="production")return null;if(Ar)return Ar;if(!e)throw new Error("HMR port is not provided");return Ar=cd(t,e),Ar},gc=t=>{if(process.env.NODE_ENV==="production")return;let e=ai();e&&e.broadcast(t)}});var wt,$r=y(()=>{st();wt=()=>{let t=Ae(),{target:e,tag:r}=t,[n,i]=e.split("-");return{tag:r,target:e,browser:n,manifestVersion:i}}});import{AssertionError as ld}from"assert";function xt(t){throw new Error("Statement should be unreachable")}function li(t,e="Value is invalid"){if(!t)throw new ld({message:e});return t}var Jt=y(()=>{});function hd(t){switch(t){case 0:return"Web";case 1:case 2:case 3:return xc[t];default:xt(t)}}var fi,Br,pi,zt,ud,fd,yc,pd,md,dd,ui,mi,Ge,Je,ae,_c,wc,ew,xc,Rr,tw,rw,vc,Sc,nw,Ee,He,gd,iw,yd,ow,sw,aw,cw,Ec=y(()=>{Jt();fi="en",Br=!1,pi=!1,zt=!1,ud=!1,fd=!1,yc=!1,pd=!1,md=!1,dd=!1,mi=fi,Je=typeof self=="object"?self:typeof global=="object"?global:{};typeof Je.vscode<"u"&&typeof Je.vscode.process<"u"?ae=Je.vscode.process:typeof process<"u"&&(ae=process);_c=typeof ae?.versions?.electron=="string",wc=_c&&ae?.type==="renderer",ew=wc&&ae?.sandboxed;typeof navigator=="object"&&!wc?(Ge=navigator.userAgent,Br=Ge.indexOf("Windows")>=0,pi=Ge.indexOf("Macintosh")>=0,md=(Ge.indexOf("Macintosh")>=0||Ge.indexOf("iPad")>=0||Ge.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,zt=Ge.indexOf("Linux")>=0,yc=!0,ui=navigator.language,mi=ui):typeof ae=="object"?(Br=ae.platform==="win32",pi=ae.platform==="darwin",zt=ae.platform==="linux",ud=zt&&!!ae.env.SNAP&&!!ae.env.SNAP_REVISION,pd=_c,dd=!!ae.env.CI||!!ae.env.BUILD_ARTIFACTSTAGINGDIRECTORY,ui=fi,mi=fi,fd=!0):console.error("Unable to resolve platform.");xc={1:"Mac",2:"Linux",3:"Windows"};Rr=0;pi?Rr=1:Br?Rr=3:zt&&(Rr=2);tw=Object.values(xc),rw=hd(Rr),vc=Br,Sc=zt,nw=yc&&typeof Je.importScripts=="function",Ee=Ge,He=mi;(n=>{function t(){return He}n.value=t;function e(){return He.length===2?He==="en":He.length>=3?He[0]==="e"&&He[1]==="n"&&He[2]==="-":!1}n.isDefaultVariant=e;function r(){return He==="en"}n.isDefault=r})(gd||={});iw=(()=>{if(typeof Je.postMessage=="function"&&!Je.importScripts){let t=[];Je.addEventListener("message",r=>{if(r.data&&r.data.vscodeScheduleAsyncWork)for(let n=0,i=t.length;n<i;n++){let o=t[n];if(o.id===r.data.vscodeScheduleAsyncWork){t.splice(n,1),o.callback();return}}});let e=0;return r=>{let n=++e;t.push({id:n,callback:r}),Je.postMessage({vscodeScheduleAsyncWork:n},"*")}}return t=>setTimeout(t)})(),yd=!!(Ee&&Ee.indexOf("Chrome")>=0),ow=!!(Ee&&Ee.indexOf("Firefox")>=0),sw=!!(!yd&&Ee&&Ee.indexOf("Safari")>=0),aw=!!(Ee&&Ee.indexOf("Edg/")>=0),cw=!!(Ee&&Ee.indexOf("Android")>=0)});var Pc,bc=y(()=>{Ec();Pc=vc?"windows":Sc?"inotify":"fs-events"});async function Ne(t,e){for(let r of t)if(await e(r))return r}var Yt=y(()=>{});import{basename as _d,extname as kc,posix as wd,win32 as xd}from"path";var ce,Cc,vt=y(()=>{ce=t=>t.replaceAll(xd.sep,wd.sep),Cc=t=>kc(_d(t,kc(t)))});import{readFile as vd}from"fs/promises";import{resolve as Sd}from"path";import{constantCase as Lc}from"change-case";import Ed from"dotenv";import{expand as Pd}from"dotenv-expand";function kd(t){let e=Object.assign({},process.env);for(let{contents:r,name:n}of t)try{Oc.add(n);let i=Pd({ignoreProcessEnv:!0,parsed:Ed.parse(r)});if(i.parsed){d(`Loaded env from ${n}`);let o=i.parsed||{};for(let[s,a]of Object.entries(o))if(typeof e[s]>"u"){try{e[s]=Ld(a)}catch(c){le(`Failed to parse JSON directive ${s} in ${n}:`,c.message)}s.startsWith(hi)&&(process.env[s]=a)}}}catch(i){le(`Failed to load env from ${n}`,i)}return e}function Ld(t){let e=t.match(Cd);return e?JSON.parse(e[1]):t}async function Ic(t){let e=await Promise.all(gi().map(o=>[o,Sd(t,o)]).map(async([o,s])=>[o,s,await sr(s)&&await or(s)])),r=await Promise.all(e.filter(([,,o])=>o).map(async([o,s])=>({name:o,contents:await vd(s,"utf8")}))),n=kd(r),i=new di(n);return{combinedEnv:n,plasmoPublicEnv:i,loadedEnvFiles:r}}var hi,bd,Oc,di,Cd,Nc,gi,jr=y(()=>{Y();k();st();hi="PLASMO_",bd="PLASMO_PUBLIC_",Oc=new Set,di=class t{data;constructor(e){this.data=Object.keys(e).filter(r=>r.startsWith(bd)).reduce((r,n)=>(r[n]=e[n],r),{})}extends(e){N("Loaded environment variables from:",[...Oc]);let r=new t({...this.data});return r.data.NODE_ENV=process.env.NODE_ENV,Object.entries(e).forEach(([n,i])=>{r.data[`${hi}${Lc(n)}`]=i}),r}};Cd=/^\s*json\((.+)\)\s*$/si;Nc=t=>{for(let[e,r]of Object.entries(t))process.env[`${hi}${Lc(e)}`]=r},gi=()=>{let t=process.env.NODE_ENV,e=Ae();return[e.envPath,`.env.${e.browser}.local`,`.env.${e.tag}.local`,`.env.${t}.local`,t!=="test"?".env.local":"",`.env.${e.browser}`,`.env.${e.tag}`,`.env.${t}`,".env"].filter(r=>!!r)}});import{resolve as Od}from"path";async function Mc({commonPath:t,publicEnv:e}){let r=Object.keys(e.data);r.length!==0&&await(0,Tc.outputFile)(Od(t.dotPlasmoDirectory,Nd),Id(r))}var Tc,yi,Nd,Id,_i=y(()=>{Tc=A(G(),1),yi="process.env",Nd=`${yi}.d.ts`,Id=t=>`
declare namespace NodeJS {
  interface ProcessEnv {
${t.map(e=>`		${e}?: string`).join(`
`)}
  }
}
`});import Td from"typescript";var we,Kt,Dc=y(()=>{({SyntaxKind:we}=Td),Kt=t=>{switch(t.kind){case we.StringLiteral:return t.text;case we.TrueKeyword:return!0;case we.FalseKeyword:return!1;case we.NullKeyword:return null;case we.NumericLiteral:return parseFloat(t.text);case we.ArrayLiteralExpression:return t.elements.filter(e=>e.kind!==we.SpreadElement).map(Kt);case we.ObjectLiteralExpression:return t.properties.filter(e=>e.kind===we.PropertyAssignment&&(e.name.kind===we.Identifier||e.name.kind===we.StringLiteral)).map(e=>[e.name.escapedText||e.name.text,Kt(e.initializer)]).reduce((e,[r,n])=>({...e,[r]:n}),{});default:return}}});import{readFile as Md}from"fs/promises";import Dd from"typescript";var Fd,Ad,$d,Rd,Bd,Fc,Ac=y(()=>{k();Dc();({ScriptTarget:Fd,SyntaxKind:Ad,createSourceFile:$d,isObjectLiteralExpression:Rd,isVariableStatement:Bd}=Dd),Fc=async t=>{try{let e=await Md(t,"utf8");if(e.length===0)return{isEmpty:!0};let n=$d(t,e,Fd.Latest,!0).statements.filter(Bd).reduce((s,a)=>(a.declarationList.forEachChild(c=>{s[c.name.getText()]=c.initializer}),s),{}),i=n.config;if(!i||!Rd(i))return null;let o=i.properties.reduce((s,a)=>{if(a.getChildCount()<3)return s;let[c,u,l]=a.getChildren(),f=c.getText();try{l.kind===Ad.Identifier?s[f]=Kt(n[l.getText()]):s[f]=Kt(l)}catch(p){le(p)}return s},{});return d("Parsed config:",o),{config:o}}catch(e){return d(e),null}}});import{basename as $c,resolve as wi}from"path";import Ur from"sharp";async function qr({assetsDirectory:t,genAssetsDirectory:e}){if(St.baseIconPaths.length===0){let o=Rc();St.baseIconPaths=o.map(s=>wi(t,s))}let r=await Ne(St.baseIconPaths,F);if(r===void 0){j("No icon found in assets directory");return}await(0,Xt.ensureDir)(e);let i=await Ur(r).toBuffer();d(`${r} found, creating resized icons`),await Promise.all(Ud.map(async o=>{if(St.devProvidedIcons[o]===void 0){let c=Rc(xi(o));St.devProvidedIcons[o]=c.map(u=>wi(t,u))}let s=await Ne(St.devProvidedIcons[o],F),a=wi(e,`icon${o}.plasmo.png`);return process.env.NODE_ENV==="development"?s!==void 0?$c(s).includes(".development.")?(0,Xt.copy)(s,a):Ur(s).grayscale().toFile(a):Ur(Buffer.from(i)).resize({width:o,height:o}).greyscale(!$c(r).includes(".development.")).toFile(a):s!==void 0?(0,Xt.copy)(s,a):Ur(Buffer.from(i)).resize({width:o,height:o}).toFile(a)}))}var Xt,xi,jd,Rc,Ud,St,vi=y(()=>{Xt=A(G(),1);Yt();Y();k();st();xi=(t=512,e="icon")=>[`${e}${t}`,`${e}-${t}`,`${e}-${t}x${t}`],jd=["icon",...xi(),...xi(1024)],Rc=(t=jd)=>{let e=Ae();return t.map(r=>[`${r}.${e.tag}.${process.env.NODE_ENV}.png`,`${r}.${process.env.NODE_ENV}.png`,`${r}.${e.tag}.png`,`${r}.png`]).flat()},Ud=[128,64,48,32,16],St={baseIconPaths:[],devProvidedIcons:{}}});import{resolve as re}from"path";var ne,Bc,Si=y(()=>{jr();ne=(t,e)=>t.reduce((r,n)=>(r[n]=e,r),{}),Bc=({sourceDirectory:t,packageFilePath:e,assetsDirectory:r},n,i)=>{let o=b=>[".ts",...i,".js"].flatMap(L=>[re(t,`${b}.${n}${L}`),re(t,`${b}.${process.env.NODE_ENV}${L}`),re(t,`${b}${L}`)]),s=(b,L=[".ts",".js"])=>L.flatMap(O=>[re(t,`${b}.${n}${O}`),re(t,b,`index.${n}${O}`),re(t,`${b}.${process.env.NODE_ENV}${O}`),re(t,b,`index.${process.env.NODE_ENV}${O}`),re(t,`${b}${O}`),re(t,b,`index${O}`)]),a=s("popup",i),c=s("options",i),u=s("devtools",i),l=s("newtab",i),f=s("sidepanel",i),p=s("popup",[".html"]),m=s("options",[".html"]),h=s("devtools",[".html"]),g=s("newtab",[".html"]),_=s("sidepanel",[".html"]),S=gi().map(b=>re(t,b)),C=s("background"),I=o("content"),J=o("sandbox"),me={[e]:2,...ne(S,1),...ne(I,7),...ne(J,19),...ne(C,5),...ne(a,15),...ne(c,17),...ne(u,13),...ne(l,9),...ne(f,11),...ne(p,16),...ne(m,18),...ne(h,14),...ne(g,10),...ne(_,12)},Te=re(t,"contents"),Me=re(t,"sandboxes"),be=re(t,"tabs"),w=re(t,"background"),E=[[20,Me],[4,be],[8,Te],[6,w],[3,r]],P=new Set(Object.keys(me)),B=new Set([...C,...I,...J,...a,...c,...u,...l,...f]);return{popupIndexList:a,popupHtmlList:p,optionsIndexList:c,optionsHtmlList:m,devtoolsIndexList:u,devtoolsHtmlList:h,newtabIndexList:l,newtabHtmlList:g,backgroundIndexList:C,backgroundDirectory:w,contentIndexList:I,contentsDirectory:Te,sidepanelIndexList:f,sidepanelHtmlList:_,sandboxIndexList:J,sandboxesDirectory:Me,tabsDirectory:be,watchPathReasonMap:me,watchDirectoryEntries:E,isEntryPath:b=>B.has(b),knownPathSet:P}}});import{resolve as qd}from"path";var jc,Ei,Wd,Uc,qc,Pi=y(()=>{jc=A(G(),1),Ei="messaging",Wd=`${Ei}.d.ts`,Uc=(t,e)=>(0,jc.outputFile)(qd(t.dotPlasmoDirectory,Wd),e),qc=(t,e)=>`
import "@plasmohq/messaging"

interface MmMetadata {
	${t.join(`
	`)}
}

interface MpMetadata {
	${e.join(`
	`)}
}

declare module "@plasmohq/messaging" {
  interface MessagesMetadata extends MmMetadata {}
  interface PortsMetadata extends MpMetadata {}
}
`});import{readFile as Vd}from"fs/promises";import{resolve as Vc}from"path";import Hd from"json5";var Wr,Wc,Gd,Jd,Hc,Gc=y(()=>{Wr=A(G(),1);Pi();_i();Wc=".plasmo/index.d.ts",Gd=[yi,Ei].map(t=>`import "./${t}"`).join(`
`),Jd=async(t,e)=>{let r=Vc(t.projectDirectory,"tsconfig.json"),n=await Vd(r,"utf8"),i=Hd.parse(n),o=new Set(i.include);o.has(e)||(i.include=[e,...o],await(0,Wr.outputJson)(r,i,{spaces:2}))},Hc=async t=>{let e=Vc(t.projectDirectory,Wc);await Promise.all([(0,Wr.outputFile)(e,Gd),Jd(t,Wc)])}});import{lstat as zd}from"fs/promises";import{resolve as Yd}from"path";async function Hr({dotPlasmoDirectory:t,cacheDirectory:e}){await(0,Vr.emptyDir)(t),await(0,Vr.ensureDir)(e)}async function Jc(t){let e=Yd(t.cacheDirectory,"parcel","data.mdb");if(!await F(e))return;let i=(await zd(e,{bigint:!0})).size/1024n**2n,o=Number(i)/1024;o>1.47&&(d(`Busting large build cache, size: ${o.toFixed(2)} GB`),await Hr(t))}var Vr,bi=y(()=>{Vr=A(G(),1);Y();k()});import Kd from"package-json";import ki from"semver";async function Xd(t=""){switch((await ct()).name){case"npm":return`"npm i -S plasmo@${t}"`;case"pnpm":return`"pnpm i plasmo@${t}"`;case"yarn":return`"yarn add plasmo@${t}"`}}var Gr,zc,Et,Zt=y(()=>{Gr=A(G(),1);Y();k();bi();cr();zc=async t=>{let{plasmoVersionFilePath:e}=t;if(!await F(e))d("Plasmo version file not found, busting cache..."),await Hr(t);else{let r=await(0,Gr.readJson)(e),n=ki.coerce(r.version),i=ki.coerce("0.89.4");(!n||n.major<i.major||n.major===i.major&&n.minor<i.minor)&&(d("Plasmo updated, busting cache..."),await Hr(t))}await(0,Gr.writeJson)(e,{version:"0.89.4"})},Et=async()=>{let t="0.89.4";try{let r=(await Kd("plasmo",{version:"latest"})).version;if(ki.lt(t,r)){let{default:n}=await import("chalk");j(n.yellowBright(`A new version of plasmo is available: v${r}`));let i=await Xd(r);Bi(n.yellow(`Run ${i} to update`))}}catch(e){le('Error fetching package information for "plasmo"',e)}}});var Zd,Jr,Yc=y(()=>{k();Zd=t=>N({target:t}),Jr=(t,e=Zd)=>{if(Array.isArray(t))return t.map(r=>Jr(r,e)).filter(r=>r!==void 0);if(typeof t=="object"){let r={};for(let n in t)t.hasOwnProperty(n)&&(r[n]=Jr(t[n],e),r[n]===void 0&&delete r[n]);return Object.keys(r).length===0?void 0:r}else return e(t)}});import{createHash as Qd}from"crypto";var zr,Ci=y(()=>{zr=t=>Qd("md5").update(t).digest("hex").slice(0,18)});import{resolve as Zc}from"path";import{cwd as eh}from"process";import Kc from"semver";var Qc,th,rh,nh,el,Xc,ih,tl,rl,Li=y(()=>{Qc=A(G(),1);Jt();Y();Pe();th=["react","svelte","vue","vanilla"],rh=[".tsx",".svelte",".vue",".jsx"],nh=new Set(rh),el=t=>nh.has(t),Xc="No supported UI library found.  You can file an RFC for a new UI Library here: https://github.com/PlasmoHQ/plasmo/issues",ih=async t=>{if(t.includes(":")){let[e,r]=t.split(":");switch(e){case"file":default:let n=await(0,Qc.readJson)(Zc(eh(),r,"package.json"));return Kc.coerce(n.version)?.major}}else return Kc.coerce(t)?.major},tl=async t=>{let e=t.dependencies??{},r=th.find(s=>s in e);if(r===void 0)return{name:"vanilla",path:"vanilla",version:8427};let n=await ih(e[r]);if(n===void 0)throw new Error(Xc);if(r==="react"&&n<18)return{name:r,path:"react17",version:n};let i=`${r}${n}`,o=Zc(t.templatePath.staticTemplatePath,i);if(!await F(o))throw new Error(Xc);return{name:r,path:i,version:n}},rl=t=>{switch(t){case"svelte":return{uiExts:[".svelte"],mountExt:".ts"};case"vue":return{uiExts:[".vue"],mountExt:".ts"};case"react":return{uiExts:[".tsx",".jsx"],mountExt:".tsx"};case"vanilla":return{uiExts:[".tsx",".jsx"],mountExt:".ts"};default:xt(t)}}});import{readFile as nl,writeFile as oh}from"fs/promises";import{join as Oi,relative as sh,resolve as xe}from"path";var Pt,Yr,il=y(()=>{Pt=A(G(),1);Yt();Y();k();vt();Ci();Pe();Li();Yr=class{constructor(e){this.plasmoManifest=e}#i={};#o={};get projectPath(){return this.plasmoManifest.projectPath}get commonPath(){return this.plasmoManifest.commonPath}get mountExt(){return this.plasmoManifest.mountExt}async init(){let[e,...r]=await Promise.all([this.#n(),this.#t("popup"),this.#t("options"),this.#t("newtab"),this.#t("devtools"),this.#t("sidepanel")]);return r}#n=async()=>{let e=xe(this.plasmoManifest.templatePath.staticTemplatePath,"common"),r=xe(this.commonPath.staticDirectory,"common");return(0,Pt.copy)(e,r)};#t=async e=>{d(`Creating static templates for ${e}`);let r=this.projectPath[`${e}IndexList`],n=this.projectPath[`${e}HtmlList`],[i,o]=await Promise.all([r,n].map(l=>Ne(l,F))),{staticDirectory:s}=this.commonPath;await(0,Pt.ensureDir)(s);let a=i!==void 0,c=a?ce(sh(s,i)):`~${e}`,u=xe(s,`${e}${this.mountExt}`);return await Promise.all([this.#e(`index${this.mountExt}`,u,{__plasmo_import_module__:c}),this.createPageHtml(e,o)]),a};generateHtml=async(e="",r="",n="")=>{let i={__plasmo_static_index_title__:this.plasmoManifest.name,__plasmo_static_script__:r};return await sr(n)?this.#r(n,e,{...i,"</body>":`<div id="__plasmo"></div><script src="${r}" type="module"></script></body>`}):this.#e("index.html",e,i)};createPageHtml=async(e,r="")=>{let n=xe(this.commonPath.dotPlasmoDirectory,`${e}.html`),i=`./static/${e}${this.mountExt}`;return this.generateHtml(n,i,r)};createPageMount=async e=>{d(`Creating page mount template for ${e.dir}`);let r=xe(this.commonPath.dotPlasmoDirectory,e.dir),n=xe(r,`${e.name}.html`);await(0,Pt.ensureDir)(r);let i=el(e.ext),o=xe(r,`${e.name}${this.mountExt}`),s=xe(this.commonPath.sourceDirectory,e.dir,`${e.name}.html`),a=await Promise.all(i?[this.#e(`index${this.mountExt}`,o,{__plasmo_import_module__:`~${ce(Oi(e.dir,e.name))}`}),this.generateHtml(n,`./${e.name}${this.mountExt}`,s)]:[this.generateHtml(n,`~${ce(Oi(e.dir,e.name))}${e.ext}`,s)]);return{htmlPath:n,wereFilesWritten:a.some(c=>c)}};createContentScriptMount=async e=>{d(`Creating content script mount for ${e.dir}`);let r=xe(this.commonPath.staticDirectory,e.dir);await(0,Pt.ensureDir)(r);let n=xe(r,`${e.name}${this.mountExt}`);return await this.#e(`content-script-ui-mount${this.mountExt}`,n,{__plasmo_mount_content_script__:`~${ce(Oi(e.dir,e.name))}`}),n};#s=async(e,r,n)=>{let i=Object.entries(n).reduce((s,[a,c])=>s.replaceAll(a,c),e),o=zr(Buffer.from(i));return this.#o[r]===o?!1:(this.#o[r]=o,await oh(r,i),!0)};#r=async(e,r,n)=>{let i=await nl(e,"utf8");return this.#s(i,r,n)};#e=async(e,r,n)=>(this.#i[e]||=await nl(xe(this.plasmoManifest.staticScaffoldPath,e),"utf8"),this.#s(this.#i[e],r,n))}});import{ok as Ie}from"assert";import{readdir as ol}from"fs/promises";import{basename as ah,dirname as ch,extname as sl,isAbsolute as lh,join as uh,parse as al,relative as Kr,resolve as ze}from"path";import{cwd as fh}from"process";import ph from"fast-glob";import{hasher as mh}from"node-object-hash";var ie,Qt,dh,hh,bt,Pe=y(()=>{ie=A(G(),1);ci();Jt();fn();Y();k();vt();jr();_i();ar();Ac();vi();Si();An();Gc();bi();Zt();Yc();il();Li();Qt={16:"./gen-assets/icon16.plasmo.png",32:"./gen-assets/icon32.plasmo.png",48:"./gen-assets/icon48.plasmo.png",64:"./gen-assets/icon64.plasmo.png",128:"./gen-assets/icon128.plasmo.png"},dh=["storage"],hh=mh({trim:!0,sort:!0}),bt=class{constructor(e){this.bundleConfig=e;this.data.icons=Qt,this.scaffolder=new Yr(this)}get browser(){return this.bundleConfig.browser}#i;get commonPath(){return li(this.#i)}#o;get projectPath(){return li(this.#o)}templatePath=xr();#n;get combinedEnv(){return Ie(this.#n),this.#n.combinedEnv}get publicEnv(){return Ie(this.#n),this.#n.plasmoPublicEnv}#t=new Set([".ts",".js"]);#s=new Set;#r;get uiLibrary(){return Ie(this.#r),this.#r.uiLibrary}get mountExt(){return Ie(this.#r),this.#r.uiExtMap.mountExt}get uiExts(){return Ie(this.#r),this.#r.uiExtMap.uiExts}#e="";#a="";data={};overideManifest={};packageData;contentScriptMap=new Map;get mainWorldScriptList(){let e=[];for(let r of this.contentScriptMap.values())r.world==="MAIN"&&e.push(r);return e}get hasMainWorldScript(){for(let e of this.contentScriptMap.values())if(e.world==="MAIN")return!0;return!1}copyMap=new Map;permissionSet=new Set;scaffolder;get changed(){return this.#e!==this.#a}get name(){return Ie(this.packageData),this.packageData.displayName}get dependencies(){return Ie(this.packageData),this.packageData.dependencies??this.packageData.peerDependencies}get devDependencies(){return Ie(this.packageData),this.packageData.devDependencies}get staticScaffoldPath(){return Ie(this.uiLibrary),ze(this.templatePath.staticTemplatePath,this.uiLibrary.path)}async initEnv(e=fh()){this.#n=await Ic(e),this.#i=at(e)}async startup(){await this.initEnv(),d(`Ensure exists: ${this.commonPath.dotPlasmoDirectory}`),await(0,ie.ensureDir)(this.commonPath.dotPlasmoDirectory),await Jc(this.commonPath),await zc(this.commonPath),await qr(this.commonPath),await Hc(this.commonPath),await this.updateEnv(),await this.updatePackageData()}async postBuild(){if(await Promise.all(Array.from(this.copyMap,async([n,i])=>{await or(n)||await(0,ie.copy)(i,n)})),!process.env.POST_BUILD_SCRIPT)return;let e=ze(process.env.POST_BUILD_SCRIPT);if(!(0,ie.existsSync)(e)){j("Post-build script is unavailable:",e);return}v(e)()}async updateEnv(){await this.initEnv(this.commonPath.projectDirectory),await Mc(this)}prefixDev=(e="")=>process.env.NODE_ENV==="development"?`DEV | ${e}`:e;async updatePackageData(){if(this.packageData=await(0,ie.readJson)(this.commonPath.packageFilePath),!this.packageData)throw new Error("Invalid package.json");this.data.version=this.packageData.version,this.data.author=this.packageData.author,this.data.name=this.prefixDev(this.packageData.displayName),this.data.description=this.packageData.description,this.packageData.homepage&&(this.data.homepage_url=this.packageData.homepage);for(let e of dh)`@plasmohq/${e}`in(this.packageData.dependencies||{})&&this.permissionSet.add(e);await this.#c(),this.overideManifest=await this.#l()}#c=async()=>{let e=await tl(this),r=rl(e.name);this.#r={uiLibrary:e,uiExtMap:r},this.#s=new Set(r.uiExts),this.uiExts.forEach(n=>{this.#t.add(n)}),this.#o=Bc(this.commonPath,this.browser,this.uiExts)};toggleOptions=(e=!1)=>(e?this.data.options_ui={page:"./options.html",open_in_tab:!0}:delete this.data.options_ui,this);toggleOverrides=(e,r=!1)=>(r?this.data.chrome_url_overrides={...this.data.chrome_url_overrides,[e]:`./${e}.html`}:delete this.data.chrome_url_overrides?.[e],this);toggleNewtab=(e=!1)=>this.toggleOverrides("newtab",e);toggleDevtools=(e=!1)=>(e?this.data.devtools_page="./devtools.html":delete this.data.devtools_page,this);isPathInvalid=e=>{if(e===void 0)return!0;let r=sl(e);if(!this.#t.has(r))return!0;let n=Cc(e);return!!(n.length>0&&n!==`.${this.browser}`||n.length===0&&(0,ie.existsSync)(e.replace(r,`.${this.browser}${r}`)))};toggleContentScript=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=await Fc(e);if(n?.isEmpty)return!1;d("Adding content script: ",e);let i=Kr(this.commonPath.dotPlasmoDirectory,e),o=sl(i),s=this.#s.has(o);if(this.uiLibrary?.name!=="vanilla"&&s){let c=uh("lab",i).replace(/(^src)[\\/]/,""),u=al(c);i=Kr(this.commonPath.dotPlasmoDirectory,await this.scaffolder.createContentScriptMount(u))}n?.config?.css&&n.config.css.length>0&&(n.config.css=n.config.css.map(c=>Kr(this.commonPath.dotPlasmoDirectory,ze(ch(e),c))));let a=this.injectEnvToObj({matches:["<all_urls>"],js:[n?.config?.world==="MAIN"?i.split(o)[0]:i],...n?.config||{}});this.contentScriptMap.set(e,a)}else this.contentScriptMap.delete(e);return gc("cs_changed"),r};addDirectory=async(e,r,n)=>(0,ie.existsSync)(e)?ol(e,{withFileTypes:!0}).then(i=>Promise.all(i.filter(o=>o.isFile()&&n?n(o.name):!0).map(o=>ze(e,o.name)).map(o=>r(o,!0)))).then(i=>i.includes(!0)):!1;addContentScriptsIndexFiles=async()=>{let e=this.projectPath.contentsDirectory;if(!await Ji(e))return!1;let r=[...this.#t].flatMap(n=>[`index${n}`,`index.${this.browser}${n}`]);return ol(e,{withFileTypes:!0}).then(n=>Promise.all(n.filter(i=>i.isDirectory()).map(i=>ze(e,i.name)).map(i=>this.addDirectory(i,this.toggleContentScript,o=>r.includes(o))))).then(n=>n.includes(!0))};addContentScriptsDirectory=async(e=this.projectPath.contentsDirectory)=>Promise.all([this.addDirectory(e,this.toggleContentScript),this.addContentScriptsIndexFiles()]).then(r=>r.includes(!0));togglePage=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=Kr(this.commonPath.sourceDirectory,e),i=al(n),{wereFilesWritten:o}=await this.scaffolder.createPageMount(i);o&&(this.#e="")}else this.#e="";return r};addPagesDirectory=async e=>this.addDirectory(e,this.togglePage);write=(e=!1)=>{this.#a=this.#e;let r=this.toJSON();if(this.#e=hh.hash(r),!(!this.changed&&!e))return d("Hash changed, updating manifest"),(0,ie.writeJson)(this.commonPath.entryManifestPath,r,{spaces:2})};toJSON=()=>{let e={...this.data},{options_ui:r,permissions:n,content_scripts:i,background:o,...s}=this.overideManifest;return e.options_ui?.page&&(e.options_ui={...e.options_ui,...r}),e.permissions=[...new Set([...this.permissionSet,...n||[]])],e.permissions?.length===0&&delete e.permissions,this.bundleConfig.manifestVersion==="mv2"&&(e.background={...e.background,...o},Object.keys(e.background).length===0&&delete e.background,s.host_permissions?.length>0&&(e.permissions=[...e.permissions||[],...s.host_permissions])),e.content_scripts=[...Array.from(this.contentScriptMap.values()).filter(a=>a.world!=="MAIN"),...i||[]],e.content_scripts.length===0&&delete e.content_scripts,{...e,...s}};#l=async()=>{if(!this.packageData?.manifest)return{};let e=await this.prepareOverrideManifest();if((e.web_accessible_resources?.length||0)>0&&(e.web_accessible_resources=await this.resolveWAR(this.packageData.manifest.web_accessible_resources)),e.browser_specific_settings)switch(this.browser){case"edge":case"safari":e.browser_specific_settings={[this.browser]:e.browser_specific_settings[this.browser]};break;case"firefox":case"gecko":e.browser_specific_settings={gecko:e.browser_specific_settings.gecko};break;default:delete e.browser_specific_settings}return e.overrides&&e.overrides[this.browser]&&(e={...e,...e.overrides[this.browser]}),delete e.overrides,this.injectEnvToObj(e)};copyProjectFile=async e=>{try{if(e.startsWith("~"))return this.copyProjectFile(e.slice(1));if(e.includes("*")){let o=await ph(e,{cwd:this.commonPath.projectDirectory,onlyFiles:!0});return await Promise.all(o.map(this.copyProjectFile)),e}let r=lh(e)?e:ze(this.commonPath.projectDirectory,e);if(!(!this.projectPath.isEntryPath(r)&&await(0,ie.pathExists)(r)))return e;let i=ze(this.commonPath.distDirectory,e);return this.copyMap.set(i,r),ce(e)}catch{return e}};copyNodeModuleFile=async e=>{try{let r=v.resolve(e,{paths:[this.commonPath.projectDirectory]}),n=ah(r),i=ze(this.commonPath.distDirectory,n);return this.copyMap.set(i,r),n}catch{return null}};injectEnvToObj=e=>Jr(e,r=>typeof r!="string"?r:r.match(/^\$(\w+)$/)?this.combinedEnv[r.substring(1)]||void 0:$i(r,this.combinedEnv))}});import{relative as gh,resolve as cl}from"path";var Xr,ll,ul=y(()=>{Xr=A(G(),1);k();vt();Pe();ll=async({indexFilePath:t="",withMessaging:e=!1,withMainWorldScript:r=!1},n)=>{d("Creating BGSW entry");let i=cl(n.commonPath.staticDirectory,"background"),o=cl(i,"index.ts"),s=gh(i,t),a=[e&&'import "./messaging"',t&&`import "${ce(s).slice(0,-3)}"`,r&&'import "./main-world-scripts"'].filter(Boolean).join(`
`);await(0,Xr.ensureDir)(i),await(0,Xr.outputFile)(o,a)}});import{relative as yh,resolve as _h}from"path";import{camelCase as fl}from"change-case";var pl,ml,dl=y(()=>{pl=A(G(),1);k();vt();Pe();ml=async t=>{try{let e=_h(t.commonPath.staticDirectory,"background","main-world-scripts.ts"),r=t.mainWorldScriptList.map(i=>{let o=i.js.map(l=>{let f=fl(l),p=`url:${ce(yh(t.commonPath.entryManifestPath,l))}`;return{importName:f,importPath:p}}),s=o.map(l=>`import ${l.importName} from "${l.importPath}"`).join(`
`),a=o.map(l=>l.importName),c=Object.entries(i).reduce((l,[f,p])=>(f!=="js"&&(l[fl(f)]=p),l),{id:a.join("-"),js:[]}),u=JSON.stringify(c).replace(/"js":\[\]/,`"js":[${a.map(l=>`${l}.split("/").pop().split("?")[0]`).join(",")}]`);return[s,u]});if(r.length===0)return!1;t.permissionSet.add("scripting");let n=`${r.map(([i])=>i).join(`
`)}
chrome.scripting.registerContentScripts([
  ${r.map(([,i])=>i).join(`,
  `)}
]).catch(_ => {})
`;return await(0,pl.outputFile)(e,n),!0}catch(e){return d(e.message),!1}}});import{camelCase as wh}from"change-case";import xh from"fast-glob";import{join as vh,resolve as Sh}from"path";var yl,hl,Eh,Ni,gl,Ph,_l,wl=y(()=>{yl=A(G(),1);Y();k();vt();Pi();Ci();Pe();hl={md5Hash:""},Eh=(t,e,r,n)=>`// @ts-nocheck
globalThis.__plasmoInternalPortMap = new Map()

${t}

chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  switch (request?.name) {
    ${r}
    default:
      break
  }

  return true
})

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  switch (request.name) {
    ${e}
    default:
      break
  }

  return true
})

chrome.runtime.onConnect.addListener(function(port) {
  globalThis.__plasmoInternalPortMap.set(port.name, port)
  port.onMessage.addListener(function(request) {
    switch (port.name) {
      ${n}
      default:
        break
    }
  })
})

`,Ni=async(t,e)=>{let r=vh(t.projectPath.backgroundDirectory,e);return await ir(r)?(await xh("**/*.ts",{cwd:r,onlyFiles:!0,ignore:e==="messages"?["external"]:[]})).map(i=>{let s=ce(i).slice(0,-3),a=`${e}/${s}`,c=wh(a);return{importName:c,name:s,declaration:`"${s}" : {}`,importCode:`import { default as ${c} } from "~background/${a}"`}}):[]},gl=(t,e)=>`case "${t}":
  ${e}({
    ...request,
    sender
  }, {
    send: (p) => sendResponse(p)
  })
  break`,Ph=(t,e)=>`case "${t}":
  ${e}({
    port,
    ...request
  }, {
    send: (p) => port.postMessage(p)
  })
  break`,_l=async t=>{try{let e=await Promise.all([Ni(t,"messages"),Ni(t,"messages/external"),Ni(t,"ports")]),[r,n,i]=e;if(d({messageHandlerList:r,externalMessageHandlerList:n,portHandlerList:i}),e.every(c=>c.length===0))return!1;if(!("@plasmohq/messaging"in t.dependencies))return j("@plasmohq/messaging is not installed, skipping messaging API"),!1;let o=qc(r.map(({declaration:c})=>c),i.map(({declaration:c})=>c)),s=zr(Buffer.from(o));if(hl.md5Hash===s)return!0;hl.md5Hash=s;let a=Eh([...r,...n,...i].map(c=>c.importCode).join(`
`),r.map(c=>gl(c.name,c.importName)).join(`
`),n.map(c=>gl(c.name,c.importName)).join(`
`),i.map(c=>Ph(c.name,c.importName)).join(`
`));return await Promise.all([(0,yl.outputFile)(Sh(t.commonPath.staticDirectory,"background","messaging.ts"),a),Uc(t.commonPath,o)]),!0}catch(e){return d(e.message),!1}}});var er,Ii=y(()=>{Yt();Y();ul();dl();wl();Pe();er=async t=>{let[e,r,n]=await Promise.all([Ne(t.projectPath.backgroundIndexList,F),_l(t),ml(t)]),i=!!e||r||n;return i&&await ll({indexFilePath:e,withMessaging:r,withMainWorldScript:n},t),t.toggleBackground(i)}});import{subscribe as bh}from"@parcel/watcher";var kh,xl,Ch,vl=y(()=>{bc();Jt();de();k();Ii();Pe();vi();Si();kh=["node_modules","build",".plasmo","coverage",".git"],xl=async t=>{if($("--impulse"))return null;let{default:e}=await import("is-path-inside"),{knownPathSet:r,watchPathReasonMap:n,watchDirectoryEntries:i}=t.projectPath;d("Watching the following files:",r);let o=s=>{if(r.has(s))return n[s];let a=i.find(([,c])=>e(s,c));return a?(r.add(s),n[s]=a[0]):0};return bh(t.commonPath.projectDirectory,async(s,a)=>{if(s)throw s;await Promise.all(a.map(({path:c,type:u})=>Ch(u,c,o(c),t))),await t.write()},{backend:Pc,ignore:kh})},Ch=async(t,e,r,n)=>{let i=t!=="delete";switch(r){case 0:return;case 1:{j("Environment file change detected, please restart the dev server."),await n.updateEnv();return}case 3:{N("Assets directory changed, update dynamic assets"),await qr(n.commonPath);return}case 2:{N("package.json changed, updating manifest overrides. You might need to restart the dev server."),await n.updatePackageData();return}case 6:case 5:{await er(n);return}case 7:case 8:{await n.toggleContentScript(e,i),n.hasMainWorldScript&&await er(n);return}case 19:case 20:case 4:{await n.togglePage(e,i);return}case 11:{n.toggleSidePanel(i);return}case 15:{n.togglePopup(i);return}case 17:{n.toggleOptions(i);return}case 13:{n.toggleDevtools(i);return}case 9:{n.toggleNewtab(i);return}case 16:{await n.scaffolder.createPageHtml("popup",i&&e);return}case 18:{await n.scaffolder.createPageHtml("options",i&&e);return}case 14:{await n.scaffolder.createPageHtml("devtools",i&&e);return}case 10:{await n.scaffolder.createPageHtml("newtab",i&&e);return}case 12:{await n.scaffolder.createPageHtml("sidepanel",i&&e);return}default:xt(r)}}});import{dirname as Lh,join as Oh,resolve as Nh}from"path";import Ih from"@parcel/fs";import Zr from"@parcel/package-manager";import{Parcel as Th}from"@plasmohq/parcel-core";var ve,Mh,Qr,Ti=y(()=>{ve=A(G(),1);de();k();cr();jr();Mh={npm:Zr.Npm,yarn:Zr.Yarn,pnpm:Zr.Pnpm},Qr=async({commonPath:t,bundleConfig:e,publicEnv:r},{defaultTargetOptions:n={},...i})=>{let o=i.mode==="production";o?await(0,ve.emptyDir)(t.distDirectory):await(0,ve.ensureDir)(t.distDirectory),process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_MINIFY=o&&$("--no-minify")?"true":"false",process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS=o?$("--inline-source-maps")?"inline":$("--source-maps")?"external":"none":$("--no-source-maps")?"none":"inline",process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_CS_RELOAD=$("--no-cs-reload")?"true":"false",process.env.__PLASMO_FRAMEWORK_INTERNAL_ES_TARGET=V("--es-target")||"es2022";let s=await ct(),a=new Ih.NodeFS,c=Mh[s.name],u=new Zr.NodePackageManager(a,t.projectDirectory,new c),l=v.resolve("@plasmohq/parcel-config"),f=Oh(Lh(l),"run.json"),p=await(0,ve.readJson)(l);$("--bundle-buddy")&&(p.reporters=["...","@parcel/reporter-bundle-buddy"]),await(0,ve.writeJson)(f,p),await(0,ve.exists)(t.parcelConfig)&&(f=t.parcelConfig,o&&(await(0,ve.readJson)(f)).extends!=="@plasmohq/parcel-config"&&j('The .parcelrc does not extend "@plasmohq/parcel-config", the result may be unexpected'),$("--bundle-buddy")&&j('The "--bundle-buddy" flag does not work with a custom .parcelrc file'));let m={browsers:e.manifestVersion==="mv2"&&e.browser!=="firefox"?["IE 11"]:["last 1 Chrome version"]};return Nc(e),new Th({inputFS:a,packageManager:u,entries:t.entryManifestPath,cacheDir:Nh(t.cacheDirectory,"parcel"),config:f,shouldAutoInstall:!0,env:r.extends(e).data,defaultTargetOptions:{...n,engines:m,sourceMaps:process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS!=="none",distDir:t.distDirectory},...i})}});var Sl,pe,El,en,Pl=y(()=>{Sl="\u{1F504} Building",pe={loadingInterval:null,isLoading:!1,dotCount:0},El=()=>{pe.isLoading||(pe.isLoading=!0,process.stdout.write(Sl),pe.loadingInterval=setInterval(()=>{pe.dotCount=(pe.dotCount+1)%4;let t=pe.dotCount===0?"   ":".".repeat(pe.dotCount);process.stdout.write(`\r${Sl}${t}`)},400))},en=()=>{pe.isLoading&&(pe.isLoading=!1,pe.loadingInterval&&(clearInterval(pe.loadingInterval),pe.loadingInterval=null),process.stdout.write("\r"+" ".repeat(20)+"\r"))}});var tn,bl=y(()=>{k();Pe();tn=class extends bt{constructor(e){super(e),this.data.manifest_version=2,this.data.browser_action={default_icon:Qt}}toggleSidePanel=(e=!1)=>{switch(this.browser){case"firefox":case"gecko":{e?this.data.sidebar_action={default_panel:"./sidepanel.html"}:delete this.data.sidebar_action;break}default:N("SidePanel is not available on chromium-based MV2 browsers, skipping.")}return this};togglePopup=(e=!1)=>(e?this.data.browser_action.default_popup="./popup.html":delete this.data.browser_action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={scripts:["./static/background/index.ts"]}:delete this.data.background,e);prepareOverrideManifest=()=>{let{manifest:e}=this.packageData,r={...e};return r.permissions=[...e.permissions||[],...e.host_permissions||[]],"host_permissions"in r&&delete r.host_permissions,"content_security_policy"in e&&(r.content_security_policy=e.content_security_policy?.extension_pages),r};resolveWAR=e=>Promise.all(e.map(async({resources:r})=>(await Promise.all(r.map(async i=>await this.copyNodeModuleFile(i)||await this.copyProjectFile(i)))).flat())).then(r=>r.flat())}});var rn,kl=y(()=>{Pe();rn=class extends bt{constructor(e){super(e),this.data.manifest_version=3,this.data.action={default_icon:Qt}}toggleSidePanel=(e=!1)=>{switch(this.browser){case"firefox":case"gecko":{e?this.data.sidebar_action={default_panel:"./sidepanel.html"}:delete this.data.sidebar_action;break}default:e?(this.data.side_panel={default_path:"./sidepanel.html"},this.permissionSet.add("sidePanel")):(delete this.data.side_panel,this.permissionSet.delete("sidePanel"))}return this};togglePopup=(e=!1)=>(e?this.data.action.default_popup="./popup.html":delete this.data.action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={service_worker:"./static/background/index.ts"}:delete this.data.background,e);prepareOverrideManifest=()=>({...this.packageData.manifest});resolveWAR=e=>Promise.all(e.map(async({resources:r,...n})=>({resources:(await Promise.all(r.map(async o=>await this.copyNodeModuleFile(o)||await this.copyProjectFile(o)))).flat(),...n})))}});async function kt(t){d("Creating Manifest Factory...");let e=t.manifestVersion==="mv3"?new rn(t):new tn(t);await e.startup();let{contentIndexList:r,sandboxIndexList:n,tabsDirectory:i,sandboxesDirectory:o}=e.projectPath,[s,a]=await Promise.all([r,n].map(g=>Ne(g,F))),c=await Promise.all([e.scaffolder.init(),e.togglePage(a,!0),e.toggleContentScript(s,!0),e.addContentScriptsDirectory(),e.addPagesDirectory(i),e.addPagesDirectory(o)]);c.push(await er(e));let u=c.flat();u.includes(!0)||j("Unable to find any entry files. The extension might be empty");let[l,f,p,m,h]=u;return e.togglePopup(l).toggleOptions(f).toggleNewtab(p).toggleDevtools(m).toggleSidePanel(h),await e.write(!0),e}var nn=y(()=>{Yt();Y();k();Ii();bl();kl()});var Cl={};Ke(Cl,{default:()=>Fh});async function Dh(){ue(),Et(),process.env.NODE_ENV="development";let t=V("--serve-port")||"1012",e=V("--serve-host")||"localhost",r=V("--hmr-port")||"1815",n=V("--hmr-host")||"localhost";N("Starting the extension development server...");let{default:i}=await import("get-port"),[o,s]=await Promise.all([i({port:parseInt(t)}),i({port:parseInt(r)})]),a=ai(n,s);d(`Starting dev server on ${e}:${o}, HMR on ${n}:${s}...`);let c=wt();N("Building for target:",c.target);let u=await kt(c),l=await xl(u),f=await Qr(u,{logLevel:"verbose",shouldBundleIncrementally:!0,serveOptions:{host:e,port:o},hmrOptions:{host:n,port:s}}),{default:p}=await import("chalk"),m=await f.watch(async(g,_)=>{if(g)throw en(),g;if(_!==void 0){if(_.type==="buildStart"){El();return}if(_.type==="buildSuccess"){en(),Fe(`Extension re-packaged in ${p.bold(_.buildTime)}ms! \u{1F680}`),await u.postBuild(),a.broadcast("build_ready");return}_.type==="buildFailure"&&(en(),Ct()||le(p.redBright(`Build failed. To debug, run ${p.bold("plasmo dev --verbose")}.`)),_.diagnostics.forEach(S=>{le(p.redBright(S.message)),S.stack&&d(S.stack),S.hints?.forEach(C=>{d(C)}),S.codeFrames?.forEach(C=>{C.code&&d(C.code),C.codeHighlights.forEach(I=>{I.message&&d(I.message),d(p.underline(`${C.filePath}:${I.start.line}:${I.start.column}`))})})})),process.env.__PLASMO_FRAMEWORK_INTERNAL_WATCHER_STARTED="true"}}),h=()=>{l?.unsubscribe(),m.unsubscribe()};process.on("SIGINT",h),process.on("SIGTERM",h)}var Fh,Ll=y(()=>{ci();de();k();$r();vl();Zt();Ti();Pl();Xe();nn();Fh=Dh});import{readdir as Ah,readFile as $h,rename as Ol,stat as Rh,writeFile as Bh}from"fs/promises";import{join as jh,resolve as Uh}from"path";var qh,Mi,Nl=y(()=>{qh=async t=>{let r=(await $h(Uh(t),"utf8")).replace(/\/_/g,"/");await Bh(t,r,"utf8")},Mi=async(t="")=>{let e=await Ah(t);for(let r of e){let n=jh(t,r);if((await Rh(n)).isDirectory()){let o=n.replace("/_","/");await Ol(n,o),await Mi(o)}else{let o=n.replace("/_","/");await Ol(n,o),await qh(o)}}}});import{mkdir as Wh}from"fs/promises";import{resolve as Di}from"path";import{sentenceCase as Vh}from"change-case";var Ye,Hh,Il,Tl=y(()=>{Ye=A(G(),1);Y();k();ar();Nl();Hh=t=>({name:Vh(t.name),description:t.description,version:t.version,manifest_version:3,chrome_url_overrides:{newtab:"./index.html"}}),Il=async()=>{let{projectDirectory:t,packageFilePath:e}=at();d("Creating a Plasmo + Nextjs based new tab extension");let r=Di(t,"out"),{default:n}=await import("chalk");if(!await F(r))throw new Error(`${n.bold("out")} directory does not exist, did you forget to run "${n.underline("next build && next export")}"?`);let i=await(0,Ye.readJson)(e),o=Di(t,"extension");if(await F(o)){let{default:{prompt:s}}=await import("inquirer"),{answer:a}=await s({type:"confirm",name:"answer",message:`${n.bold("extension")} directory already exists, do you want to overwrite it?`});if(!a)throw new Error("Aborted");await(0,Ye.emptyDir)(o)}await Wh(o),await(0,Ye.copy)(r,o),d("Extension created at:",o),await Mi(o),await(0,Ye.writeJson)(Di(o,"manifest.json"),Hh(i),{spaces:2}),Fe("Your extension is ready in the extension/ directory")}});import{createReadStream as Gh,createWriteStream as Jh}from"fs";import{resolve as Ml}from"path";import zh from"fast-glob";import{AsyncZipDeflate as Yh,Zip as Kh}from"fflate";function Xh(t){return t/1024/1024}var on,Fi=y(()=>{k();on=async({distDirectory:t,buildDirectory:e,distDirectoryName:r},n=!1)=>{let i=Ml(e,`${r}.zip`),o=Jh(i),s=await zh(["**/*",!n&&"!**/(*.js.map|*.css.map)"].filter(Boolean),{cwd:t,onlyFiles:!0});return new Promise((a,c)=>{let u=0,l=!1,f=Date.now(),p=new Kh((m,h,g)=>{l||(m?c(m):(u+=h.length,o.write(h),g&&(N(`Zip Package size: ${Xh(u).toFixed(2)} MB in ${Date.now()-f}ms`),o.end(),a())))});for(let m of s){if(l)return;let h=new Yh(m,{level:9});p.add(h);let g=Ml(t,m);Gh(g).on("data",_=>{h.push(_,!1)}).on("end",()=>{h.push(new Uint8Array(0),!0)}).on("error",_=>{l=!0,p.terminate(),c(`Error reading file ${g}: ${_.message}`)})}p.end()})}});var Dl={};Ke(Dl,{default:()=>Qh});async function Zh(){ue(),Et(),process.env.NODE_ENV="production";let[t]=tr("build");if(t==="next-new-tab"){await Il();return}N("Prepare to bundle the extension...");let e=wt();N("Building for target:",e.target);let r=await kt(e),i=await(await Qr(r,{mode:"production",shouldDisableCache:!0,shouldContentHash:!1,defaultTargetOptions:{shouldOptimize:!0,shouldScopeHoist:$("--hoist")}})).run();Fe(`Finished in ${i.buildTime}ms!`),await r.postBuild(),$("--zip")&&await on(r.commonPath)}var Qh,Fl=y(()=>{rr();de();k();$r();Tl();Zt();Ti();Xe();nn();Fi();Qh=Zh});var Al={};Ke(Al,{default:()=>tg});async function eg(){ue(),Et(),process.env.NODE_ENV="production",N("Prepare to package the extension bundle...");let t=wt(),e=await kt(t);await on(e.commonPath,$("--with-source-maps"))}var tg,$l=y(()=>{de();k();$r();Zt();Xe();nn();Fi();tg=eg});var sn={};Ke(sn,{default:()=>ng});async function rg(){console.log("0.89.4")}var ng,an=y(()=>{ng=rg});var cn,pn,Rl,mn=y(()=>{cn={help:()=>Promise.resolve().then(()=>(Wi(),qi)),start:()=>Promise.resolve().then(()=>(Hi(),Vi)),init:()=>Promise.resolve().then(()=>(fa(),ua)),dev:()=>Promise.resolve().then(()=>(Ll(),Cl)),build:()=>Promise.resolve().then(()=>(Fl(),Dl)),package:()=>Promise.resolve().then(()=>($l(),Al)),version:()=>Promise.resolve().then(()=>(an(),sn)),"-v":()=>Promise.resolve().then(()=>(an(),sn)),"--version":()=>Promise.resolve().then(()=>(an(),sn))},pn=Object.keys(cn),Rl=new Set(pn)});import{argv as Bl,exit as Ai,versions as ig}from"process";import og from"semver";de();k();mn();Xe();async function sg(){ue(),nr()}async function ag(){try{if(Bl.length>10)throw new Error("Too many arguments provided.");if(og.major(ig.node)<16)throw new Error("Node version must be >= 16");process.env.VERBOSE=Ri?"true":"false";let t=Bl.find(e=>Rl.has(e));if(t in cn){d("Running command:",t);let{default:e}=await cn[t]();await e()}else d("Running default mode"),await sg()}catch(t){le(t?.message||"Unknown error."),d(t?.stack),Ai(1)}}ag();process.on("SIGINT",()=>Ai(0));process.on("SIGTERM",()=>Ai(0));
